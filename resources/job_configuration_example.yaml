#
# Configure job execution
#
# Note: this is a YAML file, indentation is important, TAB characters are not permitted
#

# apply these properties to all jobs
default.properties: 
    executor: RuntimeExec
    java_flags: -Xmx512m

# a list of command executors
# a map of <id>:<obj>, where
#    obj := <classname> | <map>
#    classname := fully qualified classname of a class which implements the org.genepattern.server.executor.CommandExecutor interface
#    map := classname=<classname> [configuration.file: <path_to_config_file> | configuration.properties: <map>] [default.properties: <map>]
executors:
    # simple declaration, of the form <id>:<classname>
    RuntimeExec: org.genepattern.server.executor.RuntimeCommandExecutor

    # nested declaration with configuration file, <id>: { classname: <classname>, configuration: <config_file> }
    Test:
        classname: org.genepattern.server.executor.TestCommandExecutor
        configuration.file: test_command_executor.yaml

    # nested declaration with embedded configuration, <id>: { classname: <classname>, configuration: {}} 
    LSF:
        classname: org.genepattern.server.executor.lsf.LsfCommandExecutor
        #BroadCore configuration properties
        configuration.properties:
            hibernate.connection.datasource: java:comp/env/jdbc/gpdb
            hibernate.default_schema: GENEPATTERN_DEV_01
            hibernate.dialect: org.genepattern.server.database.PlatformOracle9Dialect
            hibernate.current_session_context_class: thread
            hibernate.transaction.factory_class: org.hibernate.transaction.JDBCTransactionFactory
            # number of seconds to check for completed jobs
            lsf.check.frequency: 15

        #job specific default properties applied to all jobs run with this executor
        #note: to override executor specific default properties add entries to module.properties, group.properties, or user.properties
        default.properties:
            lsf.project: genepattern
            lsf.queue: broad
            lsf.max.memory: 2
            lsf.wrapper.script: lsf_wrapper.sh
            lsf.output.filename: .lsf.out
            lsf.use.pre.exec.command: "false"
            lsf.extra.bsub.args: "null"

# override default.properties and executor->default.properties based on taskname or lsid
# Note: executor->configuration.properties are intended to be applied at startup and are not overwritten here
module.properties:
    CBS:
        executor: LSF
        lsf.max.memory: 16
        java_flags: -Xmx16g
    CopyNumberDivideByNormals:
        executor: LSF
        lsf.max.memory: 16
    ESPPredictor:
        executor: LSF
        lsf.max.memory: 8
    ExpressionFileCreator: 
        executor: LSF
        lsf.max.memory: 8
    GISTIC: 
        executor: LSF
        lsf.max.memory: 12
    GLAD: 
        executor: LSF
        lsf.max.memory: 8
    HierarchicalClustering: 
        executor: LSF
        lsf.max.memory: 4
    LOHPaired: 
        executor: LSF
        lsf.max.memory: 4
    NMFConsensus: 
        executor: LSF
        lsf.max.memory: 8
    #example usage of anchor '&' and '*' alias to reuse the same set of properties
    SNPFileCreator: &snp_settings
        executor: LSF
        lsf.max.memory: 12
        java_flags: -Xmx12g
    SNPFileSorter: *snp_settings
    SNPMultipleSampleAnalysis: *snp_settings
    XChromosomeCorrect: 
        executor: LSF
        lsf.max.memory: 4

# custom configuration settings
# by group id
group.properties:
    test:
        # override default properties for all users in group 'test'
        executor: Test
        java_flags: -Xmx2g
        # override module.properties for all users in group 'test'
        module.properties:
            ExpressionFileCreator:
                lsf.max.memory: 2
        
# by user id
user.properties:
    admin:
        # override default properties for 'admin' user
        lsf.output.filename: lsf.out
        # override module.properties for 'admin' user
        module.properties:
            ExpressionFileCreator:
                lsf.max.memory: 24
                java_flags: -Xmx24g
