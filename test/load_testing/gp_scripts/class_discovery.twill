#
# Run GenePattern Protocol: Clustering
# as user 'test'
#
# pass the server url as an arg, e.g.
# -u http://node258.broad.mit.edu:8080
# 

#Step 1: PreprocessDataset
go /gp/pages/index.jsf?lsid=PreprocessDataset
url /gp/pages/index.jsf
fv 4 input.filename_cb url
fv 4 input.filename_url ftp://ftp.broad.mit.edu/pub/genepattern/datasets/all_aml/all_aml_test.gct
submit cmd 4
code 200
url /gp/runTaskPipeline.jsp
find 'all_aml_test.preprocessed.gct'

#Step 2 (a): HierarchicalClustering
go /gp/pages/index.jsf?lsid=HierarchicalClustering
url /gp/pages/index.jsf
fv 4 input.filename_cb_url url
fv 4 input.filename_url ftp://ftp.broad.mit.edu/pub/genepattern/datasets/protocols/all_aml_test.preprocessed.gct
submit cmd 4

#Step 2 (b) KMeansClustering
go /gp/pages/index.jsf?lsid=KMeansClustering
url /gp/pages/index.jsf
fv 4 input.filename_cb_url url
fv 4 input.filename_url ftp://ftp.broad.mit.edu/pub/genepattern/datasets/all_aml/all_aml_test.res
fv 4 number.of.clusters 2
submit cmd 4

#Step 2 (c) SOMClustering
go /gp/pages/index.jsf?lsid=SOMClustering
url /gp/pages/index.jsf
fv 4 dataset.filename_url ftp://ftp.broad.mit.edu/pub/genepattern/datasets/protocols/all_aml_test.preprocessed.gct
submit cmd 4

#Step 2 (d) NMFConsensus
go /gp/pages/index.jsf?lsid=NMFConsensus
url /gp/pages/index.jsf
fv 4 dataset.filename_url ftp://ftp.broad.mit.edu/pub/genepattern/datasets/protocols/all_aml_test.preprocessed.gct
submit cmd 4

#Step 2 (e) ConsensusClustering
go /gp/pages/index.jsf?lsid=ConsensusClustering
url /gp/pages/index.jsf
fv 4 input.filename_url ftp://ftp.broad.mit.edu/pub/genepattern/datasets/protocols/all_aml_test.preprocessed.gct
submit cmd 4

#Step 4 (a): View the results w/ HierarchicalClusteringViewer
go /gp/pages/index.jsf?lsid=HierarchicalClusteringViewer
fv 4 cdt.file_url ftp://ftp.broad.mit.edu/pub/genepattern/datasets/protocols/all_aml_test.preprocessed.cdt
fv 4 gtr.file_url ftp://ftp.broad.mit.edu/pub/genepattern/datasets/protocols/all_aml_test.preprocessed.gtr
fv 4 atr.file_url ftp://ftp.broad.mit.edu/pub/genepattern/datasets/protocols/all_aml_test.preprocessed.atr
submit cmd 4

#Step 4 (b): View the results w/ HeatMapViewer
go /gp/pages/index.jsf?lsid=HeatMapViewer
fv 4 dataset_url ftp://ftp.broad.mit.edu/pub/genepattern/datasets/protocols/all_aml_test_KMcluster_output.gct
submit cmd 4

#Step 4 (c): View the results w/ SOMClusterViewer
go /gp/pages/index.jsf?lsid=SOMClusterViewer
fv 4 som.cluster.filename_url ftp://ftp.broad.mit.edu/pub/genepattern/datasets/protocols/all_aml_test.preprocessed0.odf
submit cmd 4

#Step 4 (d): View the results w/ HeatMapViewer
go /gp/pages/index.jsf?lsid=HeatMapViewer
fv 4 dataset_url ftp://ftp.broad.mit.edu/pub/genepattern/datasets/protocols/all_aml_test.preprocessed.sub28.srt.2.gct
submit cmd 4
