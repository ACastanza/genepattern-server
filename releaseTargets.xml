<target name="tag">

       <buildnumber file="build.number"/>

       <echo>making build number: ${build.number}</echo>
       <property name="cvsTag" value="gp_b${build.number}"/>
       <!-- ensure these are called after setting the build number and cvsTag -->

      <echo>STARTING tagging module gp2 in CVS with: ${cvsTag}</echo>
      <cvs command="rtag -RF ${cvsTag} gp2" failonerror="true"/>

      <echo>FINISHED tagging module gp2 in CVS with: ${cvsTag}</echo>
	<cvs command="commit -m ${cvsTag} build.number" failonerror="true"/>  

</target>

<target name="tag2">
	 <buildnumber file="build.number"/>

       <echo>making build number: ${build.number}</echo>
       <property name="cvsTag" value="gp_b${build.number}"/>

	<cvs cvsRoot=":ext:darwin:/xchip/software/mprcvs/" failonerror="true">
		<commandline>
        		<argument line="rtag -RF ${cvsTag} gp2"/>
    		</commandline>	 
	</cvs>
	<cvs cvsRoot=":ext:darwin:/xchip/software/mprcvs/"  failonerror="true" >
		<commandline>
        		<argument line="commit -m ${cvsTag} build.number"/>
    		</commandline>
		 
	</cvs>
</target>



<target name="nightlyLabel">
	<tstamp/>
 	<property name="cvsTag" value="${version}"/>


</target>


<target name="getBuildNumber">

	<property file="build.number"/>
 	<property name="cvsTag" value="gp_b${build.number}"/>

	<echo> build number is ${build.number} tag is ${cvsTag}</echo>

</target>

<target name="release" depends="getBuildNumber, website,gp-library, broad-cg, GPGE,installers" />

<target name="nightlyrelease" depends="nightlyLabel, website, gp-library, broad-cg, GPGE,installers, publishGPGEinstallerToWWWDev, createWar" />


<!-- Create a war file to use for platforms without an installer -->
<target name="createWar" depends="getBuildNumber, website,gp-library, broad-cg, GPGE, GPGEinstaller">

<!-- target name="createWar" depends="" -->

	<delete dir="wartemp"/>
	<mkdir dir="wartemp"/>
	<delete dir="ziptemp"/>
	<mkdir dir="ziptemp"/>
	<mkdir dir="ziptemp/gpinstall"/>


	<copy todir="ziptemp/gpinstall/resources">
    		<fileset dir="resources"/>
  	</copy>
	<mkdir dir="ziptemp/gpinstall/taskLib"/>
	<mkdir dir="ziptemp/gpinstall/temp"/>
	<mkdir dir="ziptemp/gpinstall/index"/>
	<mkdir dir="ziptemp/gpinstall/logs"/>
	<mkdir dir="ziptemp/gpinstall/iotemp"/>


	<copy todir="wartemp">
    		<fileset dir="website">
			<exclude name="doc/**"/>
		</fileset>
  	</copy>
	<copy todir="wartemp" file="installer/GenePatternLogo.jpg"/>

	<copy todir="wartemp/WEB-INF/classes">
    		<fileset dir="build">
			<include name="RunR.class"/>
		</fileset>
  	</copy>
	<copy todir="wartemp/WEB-INF/lib">
    		
		<fileset dir="build/jars">
			<include name="**.jar"/>
		</fileset>
		<fileset dir="build/website/lib">
			<include name="**.jar"/>
		</fileset>
		<fileset dir="lib">
			<include name="activation.jar"/>
			<include name="xerces.jar"/>
			<include name="saaj.jar"/>
			<include name="jaxrpc.jar"/>
		</fileset>

  	</copy>

	<copy todir="wartemp">
    		<fileset dir="build">
			<include name="Web_Installers/**"/>
		</fileset>
  	</copy>

	<copy todir="wartemp/downloads">
    		<fileset dir="build">
			<include name="GenePattern.zip"/>
			<include name="GenePatternMatlab.zip"/>
			<include name="GenePattern.jar"/>
			<include name="runVisualizer.jar"/>
		</fileset>
  	</copy>

	<copy todir="ziptemp/GenePattern">
    		<fileset dir="clients/R/GenePattern"/>
  	</copy>


	<move file="wartemp/WEB-INF/gpweb.xml" tofile="wartemp/WEB-INF/web.xml"/>


	<war destfile="gp.war" 
		basedir="wartemp"
		webxml="wartemp/WEB-INF/web.xml">
 
	</war>
	<copy todir="ziptemp/gpinstall/WEB-INF/lib">    		
		<fileset dir="wartemp/WEB-INF/lib">
			<include name="*.jar"/>
		</fileset>

  	</copy>
	

	<copy todir="ziptemp" file="installer/customizeWar.xml" />
	<copy todir="ziptemp" file="installer/runtimeBuild.xml" />
 	<move todir="ziptemp" file="gp.war" />



	<zip destfile="gp_war.zip" basedir="ziptemp"/>
    		
</target>


