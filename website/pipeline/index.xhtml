<!--
  ~ Copyright 2012 The Broad Institute, Inc.
  ~ SOFTWARE COPYRIGHT NOTICE
  ~ This software and its documentation are the copyright of the Broad Institute, Inc. All rights are reserved.
  ~
  ~ This software is supplied without any warranty or guaranteed support whatsoever. The Broad Institute is not responsible for its use, misuse, or functionality.
  -->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--suppress HtmlUnknownTarget -->
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
		<title>GenePattern Pipeline Editor</title>
        <!-- Normal GenePattern links -->
        <link href="/gp/css/style.css" rel="stylesheet" type="text/css" />
        <link href="/gp/skin/favicon.ico" rel="shortcut icon" />

		<link href="styles/jquery-ui.css" type="text/css" rel="stylesheet" />
		<link href="styles/pipelines.css" type="text/css" rel="stylesheet" />
		<script src="js/jquery-1.7.1.js" type="text/javascript" />
 		<script src="js/jquery-ui-1.8.16.js" type="text/javascript" />
 		<script src="js/jquery.jsPlumb-1.3.5-all.js" type="text/javascript" />
		<script src="js/jquery.tools.min.js" type="text/javascript" />
        <script src="js/jquery.iframe-post-form.js" type="text/javascript" />
		<script src="js/pipelines.js" type="text/javascript" />

        <script type="text/javascript" language="javascript">
            var createTaskAllowed = #{authorizationBean.createModuleAllowed};
            var createPublicPipelineAllowed = #{authorizationBean.createPublicPipelineAllowed};
            var createPrivatePipelineAllowed = #{authorizationBean.createPrivatePipelineAllowed};
            var createPublicSuiteAllowed = #{authorizationBean.createPublicSuiteAllowed};
            var createPrivateSuiteAllowed = #{authorizationBean.createPrivateSuiteAllowed};
            var genomeSpaceLoggedIn = #{genomeSpaceBean.loggedIn};

            function showCorrectGSLink() {
                if (genomeSpaceLoggedIn) {
                    MM_showMenu(window.mm_menu_genomespaceloggedin,x,y,null,'link24;');
                }
                else {
                    MM_showMenu(window.mm_menu_genomespace,x,y,null,'link24');
                }
            }
        </script>
        <script type="text/javascript" src="/gp/js/prototype.js"/>
        <script type="text/javascript" src="/gp/js/genepattern.js"/>
        <script type="text/javascript" src="/gp/js/mm_menu.js"/>
        <script type="text/javascript" src="/gp/js/mainMenu.js"/>
	</head>
	<body onunload="jsPlumb.unload();">
        <script language="JavaScript1.2" type="text/javascript">
            var agt = navigator.userAgent.toLowerCase();
            var isSafari2 = agt.indexOf("safari/4") != -1;
            var x = isSafari2 ? -10 : 0;
            var y =  isSafari2 ? 8 : 18;
            mmLoadMenus();
        </script>

        <!-- User settings area -->
        <div id="systemMessageLink">
            <table border="0" cellpadding="0" cellspacing="0" class="loginsettings">
                <tr valign="top">
                    <td>
                        <div style="display: inline;" >
                            <a href="#{facesContext.externalContext.requestContextPath}/pages/accountInfo.jsf">My Settings</a>
                            |
                            <a href="#{facesContext.externalContext.request.contextPath}/logout">Sign Out</a>
                            &#160;${requestScope.userID}&#160;&#160;&#160;
                        </div>
                    </td>
                </tr>
            </table>
        </div>

        <!-- top band with the logo -->
        <div id="topband" class="topband">
            <a href="/gp/pages/index.jsf" target="_top">
                <img src="/gp/images/GP-logo.gif" alt="GenePattern" height="48" style="border: 0;" width="229" />
            </a>
        </div>

        <!-- horizontal navigation band -->
        <div id="navband1" class="navband1" style="white-space: nowrap;">
            <a name="link17" id="link6" href="/gp/pages/index.jsf" onclick="MM_showMenu(window.mm_menu_tasks,x,y,null,'link17')" onmouseover="MM_showMenu(window.mm_menu_tasks,x,y,null,'link17')" onmouseout="MM_startTimeout();">Modules &amp; Pipelines</a> &#160;&#160;&#160;&#160;&#160;&#160;
            <a name="link14" id="link9" href="/gp/pages/manageSuite.jsf" onclick="MM_showMenu(window.mm_menu_suites,x,y,null,'link14')" onmouseover="MM_showMenu(window.mm_menu_suites,x,y,null,'link14')" onmouseout="MM_startTimeout();">Suites</a> &#160;&#160;&#160;&#160;&#160;&#160;
            <a name="link15" id="link10" href="/gp/jobResults" onclick="MM_showMenu(window.mm_menu_jobResults,x,y,null,'link15')" onmouseover="MM_showMenu(window.mm_menu_jobResults,x,y,null,'link15')" onmouseout="MM_startTimeout();">Job Results</a> &#160;&#160;&#160;&#160;&#160;&#160;
            <a name="link12" id="link3" href="/gp/pages/index.jsf?splash=resources" onclick="MM_showMenu(window.mm_menu_resources,x,y,null,'link12')" onmouseover="MM_showMenu(window.mm_menu_resources,x,y,null,'link12')" onmouseout="MM_startTimeout();">Resources</a> &#160;&#160;&#160;&#160;&#160;&#160;
            <a name="link2" id="link5" href="/gp/pages/index.jsf?splash=downloads" onclick="MM_showMenu(window.mm_menu_downloads,x,y,null,'link2')" onmouseover="MM_showMenu(window.mm_menu_downloads,x,y,null,'link2')" onmouseout="MM_startTimeout();">Downloads</a> &#160;&#160;&#160;&#160;&#160;&#160;
            <a name="link13" id="link4" href="/gp/pages/serverSettings.jsf" onclick="MM_showMenu(window.mm_menu_administration,x,y,null,'link13')" onmouseover="MM_showMenu(window.mm_menu_administration,x,y,null,'link13')" onmouseout="MM_startTimeout();">Administration</a>&#160;&#160;&#160;&#160;&#160;&#160;
            <a name="link11" id="link1" href="/gp/pages/index.jsf" onclick="MM_showMenu(window.mm_menu_documentation,x,y,null,'link11')" onmouseover="MM_showMenu(window.mm_menu_documentation,x,y,null,'link11')" onmouseout="MM_startTimeout();">Help</a>&#160;&#160;&#160;&#160;&#160;&#160;
            <a name="link24" id="link24" href="/gp/pages/index.jsf" onclick="showCorrectGSLink()" onmouseover="showCorrectGSLink()" onmouseout="MM_startTimeout();">
                <img style="vertical-align:middle" alt="GenomeSpace" src="/gp/pages/genomespace/genomespace_icon.gif" height="14px" width="14px" border="0" />&#160;GenomeSpace
            </a>

        </div>

        <!--  Main content area -->
        <div id="content" class="content">
            <!-- Main content body -->
            <div id="library">
                <label for="modulesDropdown" class="ui-autocomplete-input">Select Module: </label>
                <br />
                <input id="modulesDropdown" size="15" />
                <button id="addModule" class="libraryModuleButton">Add</button>&#160;&#160;&#160;
                <span id="shortcutModules" />
                <div id="libraryControls">
                    <a id="openAllCategories" href="#">Open All</a> | <a id="closeAllCategories" href="#">Close All</a>
                </div>
                <div id="categoryModules" />
            </div>
            <div id="titleBar">
                <span id="titleSpan" />
                <div id="saveLoadDiv">
                    <button id="pipelinePencil" class="saveLoadButton"><img id="pipelinePencilImg" src="images/pencil.gif" alt="Edit" />Edit</button>
                    <!-- <button id="newButton" class="saveLoadButton">New</button>
                    <button id="loadButton" class="saveLoadButton">Load</button> -->
                    <button id="saveButton" class="saveLoadButton">Save</button>
                    <button id="runButton" class="saveLoadButton">Save &amp; Run</button>
                    <button id="revertButton" class="saveLoadButton">Revert</button>
                </div>
            </div>
            <div id="workspace"></div>

            <!-- Footer -->
            <div id="footer">
                <table width="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                        <td colspan="4" class="footer">
                            <table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <tr>
                                    <td>
                                        <a href="/gp/pages/about.jsf">About GenePattern</a>&#160;|&#160;<a href="/gp/pages/contactUs.jsf">Contact Us</a>
                                    </td>
                                    <td>
                                        <div align="right">
                                            &copy;2003-2012&#160;<a href="http://www.broadinstitute.org" target="_blank">Broad Institute, MIT</a>
                                        </div>
                                    </td>
                                    <td width="10">&#160;</td>
                                    <td width="27">
                                        <a href="http://www.broadinstitute.org" target="_blank">
                                            <img src="/gp/images/broad-symbol.gif" alt="Broad Institute" height="30" style="border: 0;" width="27"/>
                                        </a>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <div id="loadPipelineDialog">
            <div id="loadPipelineHeader" >Choose Pipeline to Load</div>
            <div id="pipelineLoadList">
                <ol id="pipelineSelectList" />
            </div>
            <div id="loadPipelineButtons">
                <button id="loadPipeline" class="saveLoadButton">Load</button>
                <button id="cancelPipeline" class="saveLoadButton">Cancel</button>
            </div>
        </div>

        <div id="loadingEditorDialog">
            <div id="loadingEditorHeader" >Please Stand by While Pipeline Designer Loads</div>
            <div id="loadingEditorProgressBar" />
        </div>

		<div id="properties">
            <div id="propertiesVersion"></div>
			<div id="propertiesTitle"></div>
            <div id="propertiesSubtitle"></div>
            <div id="propertiesInput" />
		</div>
		<script type="text/javascript">
            $("#loadingEditorDialog").dialog({
                autoOpen: true,
                modal: true,
                width: 400,
                title: "Please Stand by While Pipeline Designer Loads",
                beforeClose: function() { return false; }
            });

            $("#loadingEditorProgressBar").progressbar({
                complete: function(event, ui) {
                    $("#loadingEditorDialog").dialog("destroy");
                }
            });

//            $("#loadPipelineDialog").dialog({
//                autoOpen: false,
//                modal: true,
//                width: 400,
//                title: "Choose Pipeline to Load"
//            });
//
//            $("#newButton").button();
//            $("#newButton").click(function() {
//                editor.load(null);
//            });
//
//            $("#loadButton").button();
//            $("#loadButton").click(function() {
//                library.displayLoadDialog();
//            });

            $("#pipelinePencil").button();

            $("#saveButton").button();
            $("#saveButton").click(function() {
                editor.save();
            });

            $("#runButton").button();
            $("#runButton").click(function() {
                editor.save(true);
            });

            $("#revertButton").button();
            $("#revertButton").click(function() {
                var lsid = editor.workspace["pipelineLsid"];
                editor.load(lsid);
            });
            editor.updateProgressBar();

            jsPlumb.ready(function() {
                editor.updateProgressBar();
                editor.init();
                editor.updateProgressBar();
                $.getJSON("/gp/PipelineDesigner/library", function(data) {
                    editor.updateProgressBar();
                    library.init(data);
                    editor.updateProgressBar();
                    editor.loadPipelineIfAsked();
                    editor.updateProgressBar(100);
                });
                properties.init();
                editor.updateProgressBar();
            });
		</script>
	</body>
</html>
