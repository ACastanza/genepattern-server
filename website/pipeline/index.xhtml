<!--
  ~ Copyright 2012 The Broad Institute, Inc.
  ~ SOFTWARE COPYRIGHT NOTICE
  ~ This software and its documentation are the copyright of the Broad Institute, Inc. All rights are reserved.
  ~
  ~ This software is supplied without any warranty or guaranteed support whatsoever. The Broad Institute is not responsible for its use, misuse, or functionality.
  -->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:c="http://java.sun.com/jstl/core">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
		<title>GenePattern Pipeline Editor</title>
        <!-- Normal GenePattern links -->
        <link href="/gp/css/style.css" rel="stylesheet" type="text/css" />
        <link href="/gp/skin/favicon.ico" rel="shortcut icon" />

		<link href="styles/jquery-ui.css" type="text/css" rel="stylesheet" />
		<link href="/gp/css/menu.css" type="text/css" rel="stylesheet" />
		<link href="styles/pipelines.css" type="text/css" rel="stylesheet" />
		<script src="/gp/js/jquery/jquery-1.8.3.js" type="text/javascript" />
 		<script src="/gp/js/jquery/jquery-ui-1.9.2.js" type="text/javascript" />
 		<script src="/gp/js/jquery/jquery.jsPlumb-1.3.9-all.js" type="text/javascript" />
		<script src="/gp/js/jquery/jquery.tools.min.js" type="text/javascript" />
        <script src="/gp/js/jquery/jquery.combobox.js" type="text/javascript" />
        <script src="/gp/js/jquery/jquery.iframe-post-form.js" type="text/javascript" />
        <script src="/gp/js/jquery/ddsmoothmenu.js" type="text/javascript" />
		<script src="/gp/js/menu.js" type="text/javascript" />
		<script src="js/pipelines-3.5.0.js" type="text/javascript" />

        <script type="text/javascript" language="javascript">
            // If Internet Explorer Display Alert
            if (navigator.userAgent.indexOf("MSIE") !== -1) {
				alert("The new Pipeline Designer doesn't support Internet Explorer.  Please use either Firefox, Chrome or Safari.");
            }
			
			var createTaskAllowed = #{authorizationBean.createModuleAllowed};
            var createPublicPipelineAllowed = #{authorizationBean.createPublicPipelineAllowed};
            var createPrivatePipelineAllowed = #{authorizationBean.createPrivatePipelineAllowed};
            var createPublicSuiteAllowed = #{authorizationBean.createPublicSuiteAllowed};
            var createPrivateSuiteAllowed = #{authorizationBean.createPrivateSuiteAllowed};
            var adminServerAllowed = #{authorizationBean.adminServerAllowed};
			var genomeSpaceEnabled = #{genomeSpaceBean.genomeSpaceEnabled};
            var genomeSpaceLoggedIn = #{genomeSpaceBean.loggedIn};
            var userLoggedIn = !("${requestScope.userID}" === "null" || "${requestScope.userID}" === "");
            
            // Build the nav menu
            if (userLoggedIn) {
                Menu.buildNavMenu();
            }
        </script>

	</head>
	<body onunload="jsPlumb.unload();">
        <!-- User settings area -->
        <div id="systemMessageLink">
            <table border="0" cellpadding="0" cellspacing="0" class="loginsettings">
                <tr valign="top">
                    <td>
                        <div style="display: inline;" >
                            <a href="#{facesContext.externalContext.requestContextPath}/pages/accountInfo.jsf">My Settings</a>
                            |
                            <a href="#{facesContext.externalContext.request.contextPath}/logout">Sign Out</a>
                            &#160;${requestScope.userID}&#160;&#160;&#160;
                        </div>
                    </td>
                </tr>
            </table>
        </div>

        <!-- top band with the logo -->
        <div id="topband" class="topband">
            <a href="/gp/pages/index.jsf" target="_top">
                <img src="/gp/images/GP-logo.gif" alt="GenePattern" height="48" style="border: 0;" width="229" />
            </a>
        </div>

        <!-- horizontal navigation band -->
       	<div id="navband1" class="navband1 ddsmoothmenu" style="white-space: nowrap; display:none;">
            <ul>
                <li><a href="/gp/pages/index.jsf">Modules &#38; Pipelines</a>
                    <ul>
                        <li class="createPrivatePipelineAllowed"><a href="JavaScript:Menu.denyIE('/gp/pipeline/index.jsf');">New Pipeline</a></li>
                        <li class="createTaskAllowed"><a href="JavaScript:Menu.denyIE('/gp/modules/creator.jsf');">New Module</a></li>
                        <li class="createTaskAllowed"><a href="/gp/pages/taskCatalog.jsf">Install From Repository</a></li>
                        <li><a href="/gp/pages/importTask.jsf">Install From ZIP</a></li>
                        <li><a href="/gp/pages/manageTasks.jsf">Manage</a></li>
                    </ul>
                </li>
                <li><a href="/gp/pages/manageSuite.jsf">Suites</a>
                    <ul>
                        <li class="createPrivateSuiteAllowed"><a href="/gp/pages/createSuite.jsf">New Suite</a></li>
                        <li class="createPublicSuiteAllowed"><a href="/gp/pages/suiteCatalog.jsf">Install From Repository</a></li>
                        <li><a href="/gp/pages/importTask.jsf?suite=1">Install From ZIP</a></li>
                        <li><a href="/gp/pages/manageSuite.jsf">Manage</a></li>
                    </ul>
                </li>
                <li><a href="/gp/jobResults">Job Results</a>
                    <ul>
                        <li><a href="/gp/jobResults">Results Summary</a></li>
                    </ul>
                </li>
                <li><a href="/gp/pages/index.jsf?splash=resources">Resources</a>
                    <ul>
                        <li><a href="JavaScript:Menu.go('http://www.broadinstitute.org/cancer/software/genepattern/gp_mail.html')">Mailing List</a></li>
                        <li><a href="/gp/pages/contactUs.jsf">Report Bugs</a></li>
                        <li><a href="/gp/pages/contactUs.jsf">Contact Us</a></li>
                    </ul>
                </li>
                <li><a href="/gp/pages/index.jsf?splash=downloads">Downloads</a>
                    <ul>
                        <li><a href="/gp/pages/downloadProgrammingLibaries.jsf">Programming Languages</a></li>
                        <li><a href="JavaScript:Menu.go('http://www.broadinstitute.org/cancer/software/genepattern/datasets/')">Public Datasets</a></li>
                        <li><a href="JavaScript:Menu.go('http://www.broadinstitute.org/software/gparc/')">GParc</a></li>
                    </ul>
                </li>
                <li class="adminServerAllowed"><a href="/gp/pages/serverSettings.jsf">Administration</a>
                    <ul>
                        <li><a href="/gp/pages/serverSettings.jsf">Server Settings</a></li>
                    </ul>
                </li>
                <li><a href="/gp/pages/index.jsf">Help</a>
                    <ul>
                        <li><a href="JavaScript:Menu.go('http://www.broadinstitute.org/cancer/software/genepattern/tutorial/gp_tutorial.html')">Tutorial</a></li>
                        <li><a href="JavaScript:Menu.go('http://www.broadinstitute.org/cancer/software/genepattern/desc/videos')">Video Tutorial</a></li>
                        <li><a href="JavaScript:Menu.go('http://www.broadinstitute.org/cancer/software/genepattern/tutorial/gp_web_client.html')">User Guide</a></li>
                        <li><a href="JavaScript:Menu.go('http://www.broadinstitute.org/cancer/software/genepattern/tutorial/gp_programmer.html')">Programmers Guide</a></li>
                        <li><a href="/gp/getTaskDoc.jsp">Module Documentation</a></li>
                        <li><a href="JavaScript:Menu.go('http://www.broadinstitute.org/cancer/software/genepattern/tutorial/gp_fileformats.html')">File Formats</a></li>
                        <li><a href="JavaScript:Menu.go('http://www.broadinstitute.org/cancer/software/genepattern/doc/relnotes/current/')">Release Notes</a></li>
                        <li><a href="JavaScript:Menu.go('http://www.broadinstitute.org/cancer/software/genepattern/doc/faq/')">FAQ</a></li>
                        <li><a href="/gp/pages/about.jsf">About</a></li>
                    </ul>
                </li>
                <li class="genomeSpaceMenu">
                	<a href="/gp/pages/index.jsf"><img src="/gp/pages/genomespace/genomespace_icon.gif" class="genomeSpaceIcon" alt="GenomeSpace"></img>GenomeSpace</a>
                    <ul>
                        <li class="genomeSpaceLoggedOut"><a href="/gp/pages/genomespace/signon.jsf">Login</a></li>
                        <li class="genomeSpaceLoggedIn"><a href="/gp/pages/genomespace/signon.jsf">Logout</a></li>
                        <li class="genomeSpaceLoggedOut"><a href="/gp/pages/genomespace/userRegistration.jsf">Register</a></li>
                        <li class="genomeSpaceLoggedIn"><a href="/gp/pages/genomespace/privateTool.jsf">Add as Private Tool</a></li>
                        <li><a href="JavaScript:Menu.go('https://gsui.genomespace.org/jsui/')">GenomeSpace UI</a></li>
                        <li><a href="JavaScript:Menu.go('http://www.genomespace.org/')">About</a></li>
                    </ul>
                </li>
            </ul>
            <br style="clear: left"/>
        </div>
        <script type="text/javascript">
        	if (userLoggedIn) {
        		$("#navband1").ready(function() {
        			Menu.initNavMenu();
        		});
            	
        	}
        </script>

        <!-- Main content body -->
		<div id="libraryWrapper">
			<table>
				<tr>
					<td height="100%">
						<div id="library">
				            <button id="attachFile" class="libraryModuleButton">Attach File</button>
				            <div class="spacerDiv" style="width: 90%;" />
				            <label for="modulesDropdown" class="ui-autocomplete-input">Select Module: </label>
				            <br />
				            <input id="modulesDropdown" size="15" />
				            <button id="addModule" class="libraryModuleButton">Add</button>
				            <div class="spacerDiv" style="width: 90%;" />
				            <span id="shortcutModules" />
				            <div id="libraryControls">
				                <a id="openAllCategories" href="#">Open All</a> | <a id="closeAllCategories" href="#">Close All</a>
				            </div>
				            <div id="categoryModules" />
				        </div>
					</td>
				</tr>
				<tr>
					<td class="bottomSpacer"></td>
				</tr>
			</table>
		</div>
        <div id="titleBar">
            <span id="titleSpan" />
            <div id="saveLoadDiv">
                <button id="pipelinePencil" class="saveLoadButton"><img id="pipelinePencilImg" class="topRowButton" src="images/pencil.gif" alt="Properties" />Properties</button>
                <!-- button id="loadButton" class="saveLoadButton"><img id="loadButtonImg" class="topRowButton" src="images/load.gif" alt="Load" />Load</button> -->
                <button id="saveButton" class="saveLoadButton"><img id="saveButtonImg" class="topRowButton" src="images/save.gif" alt="Save" />Save</button>
                <button id="runButton" class="saveLoadButton"><img id="runButtonImg" class="topRowButton" src="images/save_run.gif" alt="Run" />Save &amp; Run</button>
                <button id="revertButton" class="saveLoadButton"><img id="revertButtonImg" class="topRowButton" src="images/revert.gif" alt="Revert" />Revert</button>
				<button id="helpButton" class="saveLoadButton"><img id="helpButtonImg" class="topRowButton" src="images/help.gif" alt="Help" />Help</button>
            </div>
        </div>
        <div class="tableDiv">
            <div class="tableRow topTableRow">
                <div class="tableCell leftTableCell"></div>
                <div class="tableCell"></div>
            </div>
            <div class="tableRow bottomTableRow">
                <div class="tableCell leftTableCell"></div>
                <div class="tableCell" id="workspace"></div>
            </div>
        </div>

        <!-- Footer -->
        <div id="footer">
            <table width="100%" border="0" cellspacing="0" cellpadding="0">
                <tr>
                    <td colspan="4" class="footer">
                        <table width="100%" border="0" cellspacing="0" cellpadding="0">
                            <tr>
                                <td>
                                    <a href="/gp/pages/about.jsf">About GenePattern</a>&#160;|&#160;<a href="/gp/pages/contactUs.jsf">Contact Us</a>
                                </td>
                                <td>
                                    <div align="right">
                                        &copy;2003-2012&#160;<a href="http://www.broadinstitute.org" target="_blank">Broad Institute, MIT</a>
                                    </div>
                                </td>
                                <td width="10">&#160;</td>
                                <td width="27">
                                    <a href="http://www.broadinstitute.org" target="_blank">
                                        <img src="/gp/images/broad-symbol.gif" alt="Broad Institute" height="30" style="border: 0;" width="27"/>
                                    </a>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </div>

        <div id="loadPipelineDialog">
            <div id="loadPipelineHeader" >Choose Pipeline to Load</div>
            <div id="pipelineLoadList">
                <ol id="pipelineSelectList" />
            </div>
            <div id="loadPipelineButtons">
                <button id="loadPipeline" class="saveLoadButton">Load</button>
                <button id="cancelPipeline" class="saveLoadButton">Cancel</button>
            </div>
        </div>

        <div id="loadingEditorDialog">
            <div id="loadingEditorHeader" >Please Stand by While Pipeline Designer Loads</div>
            <div id="loadingEditorProgressBar" />
        </div>
		
		<div id="propertiesWrapper">
			<table>
				<tr>
					<td height="100%">
						<div id="properties">
				            <div id="propertiesVersion"></div>
							<div id="propertiesTitle"></div>
				            <div id="propertiesSubtitle"></div>
				            <div id="propertiesInput" />
						</div>
					</td>
				</tr>
				<tr>
					<td class="bottomSpacer"></td>
				</tr>
			</table>
		</div>
		<script type="text/javascript">
            $("#loadingEditorDialog").dialog({
                autoOpen: true,
                modal: true,
				dialogClass: "top-dialog",
                width: 400,
                title: "Please Stand by While Pipeline Designer Loads",
                beforeClose: function() { return false; }
            });

            $("#loadingEditorProgressBar").progressbar({
                complete: function(event, ui) {
                    $("#loadingEditorDialog").dialog("destroy");
                }
            });

            $("#loadPipelineDialog").dialog({
                autoOpen: false,
                modal: true,
				dialogClass: "top-dialog",
                width: 400,
                title: "Choose Pipeline to Load"
            });

            //$("#loadButton").button();
            //$("#loadButton").click(function() {
            //    library.displayLoadDialog();
            //});

            $("#pipelinePencil").button();

            $("#saveButton").button();
            $("#saveButton").click(function() {
                editor.save();
            });

            $("#runButton").button();
            $("#runButton").click(function() {
                editor.save(true);
            });

            $("#revertButton").button({disabled: true});
            $("#revertButton").click(function() {
                editor.revert();
            });
			
			$("#helpButton").button();
            $("#helpButton").click(function() {
                Menu.go("http://www.broadinstitute.org/cancer/software/genepattern/gp_guides/user-guide/sections/pipelines#_Pipeline_Designer_Form");
            });
			
            editor.updateProgressBar();

            jsPlumb.ready(function() {
                editor.updateProgressBar();
                editor.init();
				editor.USE_BETA_OPTIONS = #{verifyPipelineBean.useBeta};
                editor.updateProgressBar();
                $.getJSON("/gp/PipelineDesigner/library", function(data) {
                    editor.updateProgressBar();
                    library.init(data);
                    editor.updateProgressBar();
                    editor.loadPipelineIfAsked();
                    editor.updateProgressBar(100);
                });
                properties.init();
                editor.updateProgressBar();
            });
		</script>
	</body>
</html>
