<!DOCTYPE html>

<!--
~ Copyright 2013 The Broad Institute, Inc.
~ SOFTWARE COPYRIGHT NOTICE
~ This software and its documentation are the copyright of the Broad Institute, Inc. All rights are reserved.
~
~ This software is supplied without any warranty or guaranteed support whatsoever. The Broad Institute is not responsible for its use, misuse, or functionality.
-->

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:t="http://myfaces.apache.org/tomahawk">
    <f:view contentType="text/html">
        <head>
            <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
            <meta http-equiv="refresh" content="#{session.maxInactiveInterval}" />
            <meta http-equiv="x-ua-compatible" content="IE=edge" />

            <title><ui:insert name="pageTitle">GenePattern </ui:insert></title>
            
            <link type="text/css" rel="stylesheet" href="#{facesContext.externalContext.requestContextPath}/css/#{uiBean.skin}/jquery-ui-1.9.2.css?version=#{aboutBean.buildTag}" />
            <link type="text/css" rel="stylesheet" href="#{facesContext.externalContext.requestContextPath}/css/#{uiBean.skin}/style.css?version=#{aboutBean.buildTag}" />
            <link type="text/css" rel="stylesheet" href="#{facesContext.externalContext.requestContextPath}/css/#{uiBean.skin}/themes/base/jquery.ui.all.css?version=#{aboutBean.buildTag}" />
            <link type="text/css" rel="stylesheet" href="#{facesContext.externalContext.requestContextPath}/css/#{uiBean.skin}/jobSharing.css?version=#{aboutBean.buildTag}" />
            <link type="text/css" rel="stylesheet" href="#{facesContext.externalContext.requestContextPath}/css/#{uiBean.skin}/protocols.css?version=#{aboutBean.buildTag}" />
            <link type="text/css" rel="stylesheet" href="#{facesContext.externalContext.requestContextPath}/css/#{uiBean.skin}/style-jobresults.css?version=#{aboutBean.buildTag}" />
            <link type="text/css" rel="stylesheet" href="#{facesContext.externalContext.requestContextPath}/css/#{uiBean.skin}/popupMenu.css?version=#{aboutBean.buildTag}" />
            <link type="text/css" rel="stylesheet" href="#{facesContext.externalContext.requestContextPath}/css/#{uiBean.skin}/menu.css?version=#{aboutBean.buildTag}" />
            <link type="text/css" rel="stylesheet" href="#{facesContext.externalContext.requestContextPath}/css/#{uiBean.skin}/gp_tours.css?version=#{aboutBean.buildTag}" />
            <link type="text/css" rel="stylesheet" href="#{facesContext.externalContext.requestContextPath}/js/themes/default/style.css?version=#{aboutBean.buildTag}" />
            <link type="text/css" rel="stylesheet" href="#{facesContext.externalContext.requestContextPath}/css/#{uiBean.skin}/new-layout.css?version=#{aboutBean.buildTag}" />
            <link rel="shortcut icon" href="#{facesContext.externalContext.requestContextPath}/skin/favicon.ico?version=#{aboutBean.buildTag}" />

            <script type="text/javascript" language="javascript">
                var contextRoot = '#{facesContext.externalContext.requestContextPath}';
                var createTaskAllowed = #{authorizationBean.createModuleAllowed};
                var createPublicPipelineAllowed = #{authorizationBean.createPublicPipelineAllowed};
                var createPrivatePipelineAllowed = #{authorizationBean.createPrivatePipelineAllowed};
                var createPublicSuiteAllowed = #{authorizationBean.createPublicSuiteAllowed};
                var createPrivateSuiteAllowed = #{authorizationBean.createPrivateSuiteAllowed};
                var adminServerAllowed = #{authorizationBean.adminServerAllowed};
                var genomeSpaceEnabled = #{genomeSpaceBean.genomeSpaceEnabled};
                var genomeSpaceLoggedIn = #{genomeSpaceBean.loggedIn};
                var userLoggedIn = !("${requestScope.userID}" === "null" || "${requestScope.userID}" === "");
                var username = "${requestScope.userID}";
            </script>
            
            <script type="text/javascript" src="/gp/js/jquery/jquery-1.8.3.js?version=#{aboutBean.buildTag}" />
            <script type="text/javascript" src="/gp/js/jquery/jquery-ui-1.9.2.js?version=#{aboutBean.buildTag}" />
            <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/jquery/jquery.cookie.official.js?version=#{aboutBean.buildTag}" />
            <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/jquery/jquery.cookie.js?version=#{aboutBean.buildTag}" />
            <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/jquery/jquery.jstree.js?version=#{aboutBean.buildTag}" />
            <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/jquery/jquery.blockUI.js?version=#{aboutBean.buildTag}" />
            <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/jquery/jquery.highlight-4.js?version=#{aboutBean.buildTag}" />
            <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/jquery/jquery.jtruncate.pack.js?version=#{aboutBean.buildTag}" />
            <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/jquery/jquery.dialogextend.min.js?version=#{aboutBean.buildTag}" />
            <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/jquery/jquery.leftnav.js?version=#{aboutBean.buildTag}" />
            <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/jquery/ddsmoothmenu.js?version=#{aboutBean.buildTag}" />
            <script type="text/javascript">var jq = jQuery.noConflict();</script>

            <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/genepattern.js?version=#{aboutBean.buildTag}" />
            <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/mm_menu.js?version=#{aboutBean.buildTag}" />
            <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/popupMenu.js?version=#{aboutBean.buildTag}" />
            <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/commons-validator-1.3.0.js?version=#{aboutBean.buildTag}" />
            <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/protocol.js?version=#{aboutBean.buildTag}" />
            <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/menu.js?version=#{aboutBean.buildTag}" />
            <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/runtaskform_3_8_1.js?version=#{aboutBean.buildTag}"></script>

            <script type="text/javascript" language="javascript">
            	/* <![CDATA[ */
                         
	         	// Init jQuery components
	            $(document).ready(function() {
	            	$("#left-nav").tabs({
	                    cookie:{
	                        expires:1
	                    }
	                });
	            	
	            	// Build the nav menu
	            	if (userLoggedIn) {
	            	    Menu.buildNavMenu();
	            	}
	
	            	// IE layout hack
	            	if (navigator.userAgent.indexOf("MSIE") !== -1) {
	            		jq("#systemMessageLink").css("right", "");
	            		jq("#systemMessageLink").css("left", (jq(document).width() - 500) + "px");
	            	}
	            	
	            	// Display nicely at load hack
	            	$("#left-nav-tabs").show();
	            	//$($("#left-nav-tabs .ui-tabs-active a").attr("href")).show();
	            	
	            	// Load the modules
	            	$.ajax({
                        cache: false,
	                    url: '/gp/rest/v1/tasks/all.json',
	                    dataType: 'json',
	                    success: function(data, status, xhr) {
	                    	all_modules = data.all_modules;
                            initAllModulesMap(all_modules);
	                    	
	                    	// Initialize the displays on the left nav bar
	                    	$("#loading-modules").hide();
	                    	initPinned();
	                    	initRecent();

	                    	// Initialize the search slider
	                    	initSearchSlider();
	                    	
	                    	all_categories = data.all_categories;
	                        // Initialize the module browse button and slider
	                        var allnsuite = initBrowseTop();
	                        var browse = initBrowseModules();
	                                
	                        // Initialize the slider
	                        var modbrowse = $('#module-browse').searchslider({
	                            lists: [allnsuite, browse]
	                        });
	                        
	                        // Initialize the suites slider
	                        all_suites = data.all_suites;
	                        initBrowseSuites();
	                    },
                        error: function(data) {
                            var userAborted = !data.getAllResponseHeaders();
                            if (!userAborted) {
                                $("#loading-modules").text("Error Loading Modules");
                                $("#loading-modules").css("color", "red");
                                $("#loading-modules").css("font-size", "14pt");
                            }
                        }
	                });

//	            	$.ajax({
//	                    url: '/gp/rest/v1/suites/all.json',
//	                    dataType: 'json',
//	                    success: function(data, status, xhr) {
//	                    	all_suites = data;
//	                    	
//	                        // Initialize suites slider
//	                    	initBrowseSuites();
//	                    }
//	                });
	                
	             	// Load the running jobs, poll every 10 seconds
	             	if (userLoggedIn) {
	             		jobStatusPoll();
		             	setInterval(function() {
		             		jobStatusPoll();
		             	}, 30000);
	             	}
	            	
	            	// Search box controls
	                jq("#module-search-box").keyup(function(event) {
	                    if (jq(".search-widget:visible").length === 0) {
	                    	jq("#module-search").searchslider("show");
	                        setModuleSearchTitle($(this).val())
	                    }
	                    jq("#module-search").searchslider("show");
	                    jq("#module-search").searchslider("filter", $(this).val());
	                    setModuleSearchTitle($(this).val())

                        // Handle enter key
//                        if (event.originalEvent.keyIdentifier == "Enter") {
//                            jq("#module-search").searchslider("select_default", $(this).val());
//                        }
	                });
	
	                // Browse button controls
	                jq("#module-browse-button button").button().click(function() {
                        jq( ".module-listing" ).removeHighlight();
	                	jq("#module-search-box").val("");
	                	jq("#module-browse").searchslider("show");
	                });
	            });	
            	
	            /* ]]> */
            </script>

            <!-- Use this insert to override the "onLoad" initialization method.  This function is triggered from the body onload event.  -->
            <ui:insert name="validationInit">
                <script type="text/javascript" language="javascript"> function onLoad() {} </script>
            </ui:insert>

            <ui:insert name="headText" />

        </head>
        <body>
            <!-- Error message area -->
            <div id="errorMessageDiv" style="display:none;">
                            <span id="errorMessageHeader" style="font-weight:bold">
                                Please correct the following errors before proceeding:
                            </span>
                <div id="errorMessageContent"></div>
            </div>

            <!-- Info message area -->
            <div id="infoMessageDiv" style="display:none;">
                <div id="infoMessageContent"></div>
            </div>

            <!-- Include System Alert Message  -->
            <t:div id="systemAlertMessage" rendered="#{systemMessageBean.systemMessage != null}">
                <ui:include src="../pages/systemMessage.xhtml" />
            </t:div>

            <!-- JSF (Server side) errors or messages -->
            <ui:include src="../pages/messages.xhtml" />
            <h:outputText rendered="#{!empty facesContext.maximumSeverity}"><br /></h:outputText>

            <ui:insert name="body" />
        </body>
    </f:view>
</html>
