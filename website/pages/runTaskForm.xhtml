<!-- /*
 The Broad Institute
 SOFTWARE COPYRIGHT NOTICE AGREEMENT
 This software and its documentation are copyright (2003-2009) by the
 Broad Institute/Massachusetts Institute of Technology. All rights are
 reserved.
 
 This software is supplied without any warranty or guaranteed support
 whatsoever. Neither the Broad Institute nor MIT can be responsible for its
 use, misuse, or functionality.
 */ 
 --><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:ui="http://java.sun.com/jsf/facelets" 
      xmlns:h="http://java.sun.com/jsf/html" 
      xmlns:f="http://java.sun.com/jsf/core" 
      xmlns:t="http://myfaces.apache.org/tomahawk" 
      xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
      xmlns:c="http://java.sun.com/jsp/jstl/core">
<ui:composition>
        <table width="100%
                " border="0" cellspacing="0" cellpadding="0">
          <tr>
          	<td>
          		<a href="#" onclick="document.getElementById('permissionDiv').style.display = (document.getElementById('permissionDiv').style.display == 'none' ? '' : 'none'); document.getElementById('userGroupText').innerHTML = (document.getElementById('userGroupText').innerHTML == 'edit' ? 'hide' : 'edit');"><img border="0" src="/gp/images/group.gif"/> <span id="userGroupText">edit</span> group permissions</a>
          	</td>
            <td valign="top" class="maintasknav" id="maintasknav">
              <form id="toggleDescForm">
              <h:outputText rendered="#{runTaskBean.showParameterDescriptions}">
                <input name="toggleDesc" id="toggleDesc" onclick="toggleDescriptions();" type="checkbox" checked="checked">Show parameter descriptions</input>
              </h:outputText>
              <h:outputText rendered="#{! runTaskBean.showParameterDescriptions}">
                <h:selectBooleanCheckbox id="toggleDesc" onclick="toggleDescriptions();">Show parameter descriptions</h:selectBooleanCheckbox>
              </h:outputText>
              </form>
            </td>
          </tr>
          <tr>
          	<td colspan="2">
          	<div id="permissionDiv" style="display: none; margin: 5px;">               
		      <table width="100%" border="0" cellspacing="0" cellpadding="0">
		       	<tr class="tableheader-row">
		       		<th align="left">group</th>
		       		<th>read</th>
		       		<th>read/write</th>
		        </tr>
		        <t:dataList value="#{userPrefsBean.groups}" var="group">
		        <tr class="task-titlerow">
		        	<td><h:outputText>#{group}</h:outputText></td>
		        	<td align="center"><input id="perm#{group}R" type="checkbox" value="R"/></td>
		        	<td align="center"><input id="perm#{group}RW" type="checkbox" value="RW"/></td>
				</tr>
				</t:dataList>
			  </table>                  
              </div>
              </td>
          </tr>
        </table>
        <script type="text/javascript">
        	function constructPermissions() {
        		var permString = "";
        		<t:dataList value="#{userPrefsBean.groups}" var="group">
        			if (document.getElementById('perm#{group}RW').checked) permString += '#{group}:RW,';
        			else if (document.getElementById('perm#{group}R').checked) permString += '#{group}:R,';
        		</t:dataList>
        		document.getElementById("groupAccessHidden").value = permString;
        	}
        </script>
        <table width="100%" border="0" cellpadding="0" cellspacing="0" class="barhead-task">
          <tr>
            <td>#{runTaskBean.name}</td>
            <td align="right">
              <span class="barhead-version">version #{runTaskBean.version} &#160;</span>
              <!-- Version menu popup icon.  Conditionally render -->
              <h:outputText rendered="#{!empty runTaskBean.versions}">
                <img src="#{facesContext.externalContext.requestContextPath}/images/menuicon-2.gif"
                     name="Image_versionPopupMenu" id="Image_versionPopupMenu" width="14" height="14" border="0" valign="middle"
                     onclick="pm_showMenu('versionPopupMenu', Position.cumulativeOffset(this), 20, 0);"
                     onmouseover="MM_swapImage('Image_versionPopupMenu','','#{facesContext.externalContext.requestContextPath}/images/menuicon-over.gif',2)"
                     onmouseout="MM_swapImgRestore();"/>
                <br/>
              </h:outputText>
            </td>
          </tr>
        </table>
        <form action="#{facesContext.externalContext.requestContextPath}/#{runTaskBean.formAction}" method="post" id="taskForm" enctype="multipart/form-data" onsubmit="constructPermissions(); return validateForm();">
          <input type="hidden" id="taskLSID" name="taskLSID" value="#{runTaskBean.encodedLsid}"/>
          <input type="hidden" id="taskName" name="taskName" value="#{runTaskBean.name}"/>
          <input type="hidden" id="groupAccessHidden" name="groupAccess" value=""/>
          <table border="0" cellpadding="5" cellspacing="0" class="attribute" valign="top">
            <tbody>
              <tr class="taskperameter">
                <td>
                  <span class="description">
                    <h:outputText rendered="#{runTaskBean.inputParametersExist}">* required field</h:outputText>
                  </span>
                </td>
                <td colspan="2" class="maintasknav2"> 
                  <input id="cmd1" name="cmd1" value="Run" type="submit"/>
                  <input id="reset" name="reset" value="Reset" type="button"
                         onclick="document.location='#{facesContext.externalContext.requestContextPath}/pages/index.jsf?lsid=#{runTaskBean.encodedLsid}'"/> &#160;&#160;
                  <h:outputText rendered="#{runTaskBean.pipeline}">
                    <a href="#{facesContext.externalContext.requestContextPath}/viewPipeline.jsp?name=#{runTaskBean.lsid}">properties</a>&#160;|&#160;
                    <a onclick="exportPipeline('#{runTaskBean.lsid}', '#{runTaskBean.name}');" href="#">export</a>&#160;|&#160;
                    <h:outputText rendered="#{runTaskBean.editAllowed}">
                      <a href="#{facesContext.externalContext.requestContextPath}/pipelineDesigner.jsp?name=#{runTaskBean.lsid}">edit</a>&#160;|&#160;
                    </h:outputText>
                  </h:outputText>
                  <h:outputText rendered="#{!runTaskBean.pipeline}">
                    <a href="#{facesContext.externalContext.requestContextPath}/addTask.jsp?name=#{runTaskBean.lsid}&#38;view=1">properties</a>&#160;|&#160;
                    <a href="#{facesContext.externalContext.requestContextPath}/makeZip.jsp?name=#{runTaskBean.lsid}">export</a>&#160;|&#160;
                    <h:panelGroup rendered="#{runTaskBean.editAllowed}">
                      <a href="#{facesContext.externalContext.requestContextPath}/addTask.jsp?name=#{runTaskBean.lsid}">edit</a>&#160;|&#160;
                    </h:panelGroup>
                  </h:outputText>
                  <a target="_blank" href="#{facesContext.externalContext.requestContextPath}/getTaskDoc.jsp?name=#{runTaskBean.lsid}">help</a>
                </td>
              </tr>

              <!-- Loop through parameters -->
              <t:dataList value="#{runTaskBean.parameters}" var="p">
                <tr>
                  <!-- Parameter label -->
                  <td valign="top" class="#{p.optional==false ? 'attribute-required' : ''}" style="white-space: nowrap;"
                  >#{p.displayName} <h:outputText rendered="#{!p.optional}" value="*"/></td>
                  <td valign="top" id="#{p.name}_td">
                  
                    <!-- File input -->
                    <h:outputText rendered="#{p.inputType=='file'}">
                      <h:outputText rendered="#{empty p.defaultValue}">
                        <div id="#{p.name}_div_file">
                          <input name="#{p.name}" id="#{p.name}" size="30" type="file"/>
                        </div>
                        <div id="#{p.name}_div_url" style="display:none">
                          <input id="#{p.name}_url" name="#{p.name}_url" size="30" type="text" value="#{p.defaultValue}"/>
                          <h:outputText rendered="#{runTaskBean.allowInputFilePaths}">
                          		<script type="text/javascript">
                          		// construct a map of display names to page links
                          		// from the information provided about data sources
                          		var dsMap = new Array();
                          		dsMap['Server File System'] = "#{facesContext.externalContext.requestContextPath}/jqueryFileTree/index.jsf?p=#{p.name}";
                          		dsMap['GEO'] = "#{facesContext.externalContext.requestContextPath}/plugins/ds/GEO/index.jsp?parameterName=#{p.name}";
                          		dsMap['Simple'] = "#{facesContext.externalContext.requestContextPath}/plugins/ds/simple/index.jsp?parameterName=#{p.name}";
                          		
                          		function openLyteBox(title) {
                          			if (title == 'select a data source') return true;
                          			var a = document.createElement("a");
									a.href = dsMap[title];
									a.rel = "lyteframe";
									a.title = title;
									a.rev = "width: 500px; height: 300px; scrolling: auto";
									myLytebox.start( a, false, true);
								}
                          		</script>
                          		<div style="padding-top: 5px; padding-bottom: 5px;">Other Data Sources: 
                          			<select onChange="openLyteBox(this.value)"><option value="select a data source">select a data source...</option><option value="Server File System">Server File System</option><option value="Simple">Simple Links</option><option value="GEO">GEO</option></select>
                                <!--a onclick='openLyteBox("Browse for #{p.name}", "#{facesContext.externalContext.requestContextPath}/jqueryFileTree/index.jsf?p=#{p.name}")' href="#">Browse Server File System...</a-->
								</div>
                        </h:outputText>
                        </div>
                        <span class="description" style="display:inline">
                            <input type="radio" id="#{p.name}_cb_url" name="#{p.name}_cb" value="url" 
                                onclick="showUrlInput('#{p.name}');"><h:outputText rendered="#{runTaskBean.allowInputFilePaths}">Specify File Path or URL</h:outputText><h:outputText rendered="#{!runTaskBean.allowInputFilePaths}">Specify URL</h:outputText></input></span>
                        <span class="description" style="display:inline"><input type="radio" id="#{p.name}_cb_file" name="#{p.name}_cb" value="file" onclick="showFileInput('#{p.name}');" checked="yes">Upload
                                    File</input></span>
                      </h:outputText>
                      
                      <h:outputText rendered="#{!empty p.defaultValue}">
                        <div id="#{p.name}_div_file" style="display:none">
                          <input name="#{p.name}" id="#{p.name}" size="30" type="file"/>
                        </div>
                        <div id="#{p.name}_div_url">
                          <input id="#{p.name}_url" name="#{p.name}_url" size="30" type="text" value="#{p.defaultValue}"/>
                          <h:outputText rendered="#{runTaskBean.allowInputFilePaths}">
                                <a rel="lyteframe" title="Browse for #{p.name}" rev="width: 400px; height: 300px; scrolling: auto" 
                                    href="#{facesContext.externalContext.requestContextPath}/jqueryFileTree/index.jsf?p=#{p.name}">Browse Server File System...</a>
                        </h:outputText>
                        </div>
                        <span class="description" style="display:inline">
                            <input type="radio" id="#{p.name}_cb_url" name="#{p.name}_cb" value="url" onclick="showUrlInput('#{p.name}');" 
                                checked="yes"><h:outputText rendered="#{runTaskBean.allowInputFilePaths}">Specify File Path or URL</h:outputText><h:outputText rendered="#{!runTaskBean.allowInputFilePaths}">Specify URL</h:outputText></input>
                        </span>
                        <span class="description" style="display:inline">
                            <input type="radio" id="#{p.name}_cb_file" name="#{p.name}_cb" value="file" onclick="showFileInput('#{p.name}');">Upload File</input>
                        </span>
                      </h:outputText>
                    </h:outputText>
                    <!-- Select list input -->
                    <h:outputText rendered="#{p.inputType=='select'}">
                      <select name="#{p.name}" id="#{p.name}">
                        <t:dataList value="#{p.choices}" var="c">
                          <h:outputText rendered="#{c.selected}">
                            <option value="#{c.value}" selected="true">#{c.label}</option>
                          </h:outputText>
                          <h:outputText rendered="#{!c.selected}">
                            <option value="#{c.value}">#{c.label}</option>
                          </h:outputText>
                        </t:dataList>
                      </select>
                    </h:outputText>
                    <!--  Text or password input -->
                    <h:outputText rendered="#{p.inputType=='text' || p.inputType=='password'}">
                      <input name="#{p.name}" id="#{p.name}" size="30" type="#{p.inputType}" value="#{p.defaultValue}"/>
                    </h:outputText>
                  </td>
                </tr>
                <tr class="taskperameter">
                  <td/>
                  <h:outputText rendered="#{runTaskBean.showParameterDescriptions}">
                    <td valign="top" class="description">
                      <span class="parameter_description" style="display:inline">#{p.displayDescription}</span>
                    </td>
                  </h:outputText>
                  <h:outputText rendered="#{!runTaskBean.showParameterDescriptions}">
                    <td valign="top" class="description">
                      <span class="parameter_description" style="display:none">#{p.displayDescription}</span>
                    </td>
                  </h:outputText>
                </tr>
              </t:dataList>
              <h:outputText rendered="#{!empty runTaskBean.parameters}">
                <tr>
                  <td valign="top">&#160;</td>
                  <td colspan="2" class="maintasknav2">
                    <input id="cmd2" name="cmd2" value="Run" type="submit"/>
                    <input id="reset2" name="reset2" value="Reset" onclick="document.location='#{facesContext.externalContext.requestContextPath}/pages/index.jsf?lsid=#{runTaskBean.encodedLsid}'" type="button"/> &#160;&#160;
                  <h:outputText rendered="#{runTaskBean.pipeline}">
                      <a href="#{facesContext.externalContext.requestContextPath}/viewPipeline.jsp?name=#{runTaskBean.lsid}">properties</a>&#160;|&#160;
                      <a onclick="exportPipeline('#{runTaskBean.lsid}', '#{runTaskBean.name}');" href="#">export</a>&#160;|&#160;
                      <h:outputText rendered="#{runTaskBean.editAllowed}">
                        <a href="#{facesContext.externalContext.requestContextPath}/pipelineDesigner.jsp?name=#{runTaskBean.lsid}">edit</a>&#160;|&#160;
                      </h:outputText>
                  </h:outputText>
                  <h:outputText rendered="#{!runTaskBean.pipeline}">
                    <a href="#{facesContext.externalContext.requestContextPath}/addTask.jsp?name=#{runTaskBean.lsid}&#38;view=1">properties</a>&#160;|&#160;
                    <a href="#{facesContext.externalContext.requestContextPath}/makeZip.jsp?name=#{runTaskBean.lsid}">export</a>&#160;|&#160;
                    <h:panelGroup rendered="#{runTaskBean.editAllowed}">
                      <a href="#{facesContext.externalContext.requestContextPath}/addTask.jsp?name=#{runTaskBean.lsid}">edit</a>&#160;|&#160;
                    </h:panelGroup>
                  </h:outputText>
                  <a target="_blank" href="#{facesContext.externalContext.requestContextPath}/getTaskDoc.jsp?name=#{runTaskBean.lsid}">help</a>
                  </td>
                </tr>
              </h:outputText>
            </tbody>
          </table>
          <p>&#160;</p>
          <br/>
          <div class="download_code">
            <strong>View code to call
            #{runTaskBean.name}: </strong>
            <div id="codeDiv">&#160;</div>
            <select name="gp_languageSelector" id="gp_languageSelector">
              <option selected="selected">- Language -</option>
              <option>Java</option>
              <option>MATLAB</option>
              <option>R</option>
            </select> &#160; <input name="viewCodeBtn" id="viewCodeBtn" type="button" onclick="viewCode();" value="View Code"/>
          </div>
        </form>

</ui:composition>
</html>
