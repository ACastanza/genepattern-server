<!--
  ~ Copyright 2012 The Broad Institute, Inc.
  ~ SOFTWARE COPYRIGHT NOTICE
  ~ This software and its documentation are the copyright of the Broad Institute, Inc. All rights are reserved.
  ~
  ~ This software is supplied without any warranty or guaranteed support whatsoever. The Broad Institute is not responsible for its use, misuse, or functionality.
  -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:t="http://myfaces.apache.org/tomahawk" xmlns:c="http://java.sun.com/jstl/core">
    <ui:composition>
        <div id="menuDiv_#{file.formattedId}" style="display:none;" class="popupMenu">
            <table>
                <tbody>
                    <h:outputText>
                        <tr>
                            <td>
                                <h:commandLink value="Delete" onclick="return confirm('Are you sure you want to delete the selected file from GenomeSpace?');" action="#{genomeSpaceBean.deleteFile}" immediate="true">
                                    <f:param value="#{file.url}" name="url" />
                                </h:commandLink>
                            </td>
                        </tr>
                    </h:outputText>
                    <h:outputText rendered="#{not file.directory}">
                        <tr>
                            <td>
                                <h:commandLink value="Save" action="#{genomeSpaceBean.saveFile}" immediate="true">
                                    <f:param value="#{file.url}" name="url" />
                                </h:commandLink>
                            </td>
                        </tr>
                    </h:outputText>

                    <h:outputText rendered="#{file.directory}">
                        <tr>
                            <td>
                                <img src="#{facesContext.externalContext.requestContextPath}/images/divider-pix2.gif" width="100%" height="1" />
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <h:outputText value="Create Subdirectory" />
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <t:inputText id="dirName" rendered="#{file.directory}" styleClass="subdirName" />
                                <h:commandLink value="Create" action="#{genomeSpaceBean.createDirectory}" immediate="true">
                                    <f:param name="parentUrl" value="#{file.url}" />
                                </h:commandLink>
                            </td>
                        </tr>
                    </h:outputText>

                    <h:outputText rendered="#{not empty genomeSpaceBean.kindToTools[file.kind] and not file.directory}">
                        <tr>
                            <td>
                                <img src="#{facesContext.externalContext.requestContextPath}/images/divider-pix2.gif" width="100%" height="1" />
                            </td>
                        </tr>
                    </h:outputText>
                    <h:outputText rendered="#{not file.directory}">
                        <t:dataList value="#{file.availableFormats}" var="format">
                            <t:dataList value="#{genomeSpaceBean.kindToTools[format]}" var="tool">
                                <tr>
                                    <td>
                                        <!-- <img src="/gp/pages/genomespace/genomespace_icon.gif" height="14px" width="14px" border="0" style="vertical-align:middle" />&#160; -->
                                        <h:commandLink value="Send to #{tool} as #{format}" action="#{genomeSpaceBean.forwardToTool}" immediate="true">
                                            <f:param value="${file.url}" name="file" />
                                            <f:param value="#{tool}" name="tool" />
                                        </h:commandLink>
                                    </td>
                                </tr>
                            </t:dataList>
                        </t:dataList>
                    </h:outputText>

                    <h:outputText rendered="#{not empty genomeSpaceBean.sendToParameters[file.kind]}">
                        <tr>
                            <td>
                                <img src="#{facesContext.externalContext.requestContextPath}/images/divider-pix2.gif" width="100%" height="1" />
                            </td>
                        </tr>
                    </h:outputText>
                    <t:dataList value="#{genomeSpaceBean.sendToParameters[file.kind]}" var="parameter">
                        <tr>
                            <td>
                                <h:outputLink value="#" onclick="setInputField('#{parameter.name}', '#{file.url}');">
                                    <h:outputText>Send to #{parameter.name}</h:outputText>
                                </h:outputLink>
                            </td>
                        </tr>
                    </t:dataList>

                    <t:dataList value="#{file.conversionsWithKind}" var="format">
                        <h:outputText rendered="#{not empty genomeSpaceBean.kindToModules[format] and not file.directory}">
                            <tr>
                                <td>
                                    <img src="#{facesContext.externalContext.requestContextPath}/images/divider-pix2.gif" width="100%" height="1" />
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <h:outputText value="Sent by GenomeSpace as #{format}" />
                                </td>
                            </tr>
                            <t:dataList value="#{genomeSpaceBean.kindToModules[format]}" var="moduleMenuItem">
                                <tr>
                                    <td>
                                        <h:outputLink value="index.jsf?lsid=#{moduleMenuItem.lsid}&amp;_file=#{file.encodedUrl}&amp;_format=#{format}"  style="white-space: nowrap;">
                                            <h:outputText value="#{moduleMenuItem.name}" />
                                        </h:outputLink>
                                    </td>
                                </tr>
                            </t:dataList>
                        </h:outputText>
                    </t:dataList>
                </tbody>
            </table>
        </div>
        <script type="text/javascript" language="javascript">
            //var element = document.getElementById("menuDiv_#{file.formattedId}");
            //element.parentNode.removeChild(element);
            //document.body.appendChild(element);
        </script>
    </ui:composition>
</html>