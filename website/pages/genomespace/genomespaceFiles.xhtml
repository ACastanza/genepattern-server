<!-- /*
The Broad Institute
SOFTWARE COPYRIGHT NOTICE AGREEMENT
This software and its documentation are copyright (2003-2011) by the
Broad Institute/Massachusetts Institute of Technology. All rights are
reserved.
This software is supplied without any warranty or guaranteed support
whatsoever. Neither the Broad Institute nor MIT can be responsible for its
use, misuse, or functionality.
*/ -->
 <!DOCTYPE html PUBLIC "-/W3C/DTD XHTML 1.0 Transitional/EN" "http:/www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
		xmlns:ui="http://java.sun.com/jsf/facelets" 
		xmlns:h="http://java.sun.com/jsf/html" 
		xmlns:f="http://java.sun.com/jsf/core" 
		xmlns:t="http://myfaces.apache.org/tomahawk" 
		xmlns:rich="http://richfaces.org/rich" 
		xmlns:c="http://java.sun.com/jstl/core">
    <ui:composition>
        <ui:define name="headText">
            <script type="text/javascript" language="javascript">	
                /* <![CDATA[ */
                var jobIdToChildJobs = new Object();
                
                function addChildJob(jobNumber, childJobId) {
                	var rowIds = jobIdToChildJobs[jobNumber];
                	if(rowIds == null) {
                		rowIds = new Array();
                        jobIdToChildJobs[jobNumber] = rowIds;
                	}
                	rowIds[rowIds.length] = childJobId;
                }
                
                function toggleJobVisibility(jobNo) {
                	var d = pt(jobNo + "_div");
                 	var downArrow = pt(jobNo + "_expanded_img");
                   	var rightArrow = pt(jobNo + "_collapsed_img");
                   	var style = "none";
                   	if(d.style.display == "inline") {
                		d.style.display = "none";
                      	downArrow.style.display = "none";
                		rightArrow.style.display = "inline";
                		// pt("expansion_state_" + jobNo).value = "false";
                	} else {
                		style = "inline";
                      	d.style.display = "inline";
                      	downArrow.style.display = "inline";
                		rightArrow.style.display = "none";
                		// pt("expansion_state_" + jobNo).value = "true";
                	} 
                	
                	var childJobs = jobIdToChildJobs[jobNo];
                	if(childJobs!=null) {
                		for(var i=0; i<childJobs.length; i++) {
                			pt(childJobs[i]).style.display = style;
                		}
                	}
                }
                /* ]]> */
            </script>
        </ui:define>
        <h:form>
        	<div style="text-align:right">
        		<strong>Logged in as: #{genomeSpaceBean.username} &nbsp;&nbsp;&nbsp;</strong>  
				<h:commandButton value="Refresh" action="#{genomeSpaceBean.forceFileRefresh}" />
        	</div>
            <table width="100%" border="0" cellspacing="0" cellpadding="0">
                <tr>
                    <td height="6" colspan="6">
                        <t:graphicImage value="/images/spacer.gif" width="1" height="6"/>
                    </td>
                </tr>
                <tr>
                    <td>
                        <rich:tree switchType="ajax" iconCollapsed="/images/collapsed.gif" iconExpanded="/images/expanded.gif" changeExpandListener="#{genomeSpaceBean.updateExpand}">
         					<rich:recursiveTreeNodesAdaptor roots="#{genomeSpaceBean.fileTree}" var="gsFile" nodes="#{gsFile.childFiles}">
								<rich:treeNode icon="/images/iconFolder.gif" iconLeaf="/images/iconLeaf.gif">
	                                <h:outputLink rendered="#{not gsFile.directory}" value="#{gsFile.url}">#{gsFile.name}</h:outputLink>
									<h:outputText rendered="#{gsFile.directory}">#{gsFile.name}</h:outputText>
	                                <!-- Image for popup menu -->
									<t:graphicImage value="/images/smallOptions.gif" name="Image_#{gsFile.formattedId}"
											onclick="pm_showMenu('menuDiv_#{gsFile.formattedId}', Position.cumulativeOffset(this), 50, 50);" 
											onmouseover="MM_swapImage('Image_#{gsFile.formattedId}','','/gp/images/smallOptions2.gif',2)" 
											onmouseout="MM_swapImgRestore();" />
	                                <br/>
	                                <h:outputText rendered="#{not gsFile.directory}">#{gsFile.formattedModified}; #{gsFile.formattedLength}</h:outputText>
	                                <br/>
									<ui:include src="fileMenu.xhtml">
           								<ui:param name="file" value="#{gsFile}"/>
           							</ui:include>
	                            </rich:treeNode>
         					</rich:recursiveTreeNodesAdaptor>
      					</rich:tree>
                    </td>
                </tr>
                <tr>
                    <td colspan="6">
                        <img src="#{facesContext.externalContext.requestContextPath}/images/divider-pix2.gif" width="100%" height="1" vspace="5"/>
                    </td>
                </tr>
            </table>
        </h:form>
        <p>
            <br/>
        </p>
        <p>
            <br/>
        </p>
        <p>
            &nbsp;
        </p>
        <p>
            <br/>
        </p>
        <p>
            <br/>
        </p>
    </ui:composition>
</html>
