<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:ui="http://java.sun.com/jsf/facelets" 
      xmlns:h="http://java.sun.com/jsf/html" 
      xmlns:f="http://java.sun.com/jsf/core" 
      xmlns:t="http://myfaces.apache.org/tomahawk"
      xmlns:c="http://java.sun.com/jstl/core">
      
  <ui:composition template="/templates/common.xhtml">
    <ui:define name="pageTitle">
    	GenePattern | Manage Modules and Pipelines
    </ui:define>
    <ui:define name="headText">
      <link href="#{facesContext.externalContext.requestContextPath}/css/style-jobresults.css" rel="stylesheet" type="text/css"/>
      <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/jobResults.js"/>
      <script type="text/javascript" language="javascript"> 

/* <![CDATA[ */

    
    // Toggle the version checkboxes for a particular task
    function toggleChildrenCheckboxes(node, id)
    { 	var checkboxDivs = document.getElementsByName("div_"+id);
    	var isChecked = node.checked;
    	
    	for (var i=0; i<checkboxDivs.length; i++) {
    		var childrenCheckboxes = checkboxDivs[i].getElementsByTagName("input");
    		for (var j=0; j<childrenCheckboxes.length; j++) { 
		        if(childrenCheckboxes[j].type == "checkbox" && !childrenCheckboxes[j].disabled) {
		          	childrenCheckboxes[j].checked = isChecked;
		        }	        
		    }
    	}
    }
     
    // Toggle all checkboxes.  
    function toggleAllCheckboxes(node)
    {	 var maincheckboxes = document.getElementsByTagName("input");
    	 
	     var isChecked = node.checked;
	     for (var i=0; i<maincheckboxes.length; i++) {
	         if(maincheckboxes[i].type == "checkbox" && !maincheckboxes[i].disabled) {
	          	maincheckboxes[i].checked = isChecked;
	         }
	      }
    }
 	
	function confirmDelete() {
		return confirm('Are you sure you want to delete the selected module(s)?');

	}
	
    /* ]]> */

	</script>
    </ui:define>    
    <ui:define name="body">
      
      <table width="100%" border="0" cellpadding="0" cellspacing="0" class="barhead-other">
        <tr>
          <td>Manage Modules and Pipelines</td>
        </tr>
      </table>
      <h:form >
      <table width="100%"  border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td valign="top" class="maintasknav" id="maintasknav" align="right" width="100%">
            <h:selectBooleanCheckbox  value="#{manageTasksBean.showEveryonesTasks}" onchange="this.form.submit();"/>show everyone's modules&#160;&#160;&#160;&#160;
          </td>
        </tr>
      </table>
      <table border="0" cellpadding="0" cellspacing="0" width="100%">
        <tbody>
          <tr class="smalltype">
            <td valign="top" align="center">
              <h:commandLink value="delete" actionListener="#{manageTasksBean.delete}" onclick="if (!confirmDelete()) return false"/> 
            </td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
          </tr>
          <tr class="tableheader-row">
            <td align="center"><input name="checkbox" type="checkbox" onclick="toggleAllCheckboxes(this);" />            </td>
            <td>version&#160;</td>
            <td>name&#160;</td>
            <td>used by  &#160;</td>
          </tr>

          <!--  Loop through tasklist -->
          <!--  Something like <t:dataList var="taskObject" value="#{someBean.someMethod}" rowIndexVar="taskIndex">  -->
 
          <!--  Task title row -->
          <div align="center" id="mainDiv">
          <t:dataList var="taskGroup" value="#{manageTasksBean.tasks}">
            <tr valign="top" class="task-title">
          	  <td>
		        <!-- Task select checkbox -->
		        <div align="center" id="main_#{taskGroup.lsidNoVersion}">
		        	<t:div rendered="#{!taskGroup.allowed}">
					  	<input type="checkbox" name="selectedTasks" disabled="true" value="#{taskGroup.lsidNoVersion}" onclick="toggleChildrenCheckboxes(this, '#{taskGroup.lsidNoVersion}');"/>
					</t:div>
					<t:div rendered="#{taskGroup.allowed}">
					  	<input type="checkbox" name="selectedTasks" value="#{taskGroup.lsidNoVersion}" onclick="toggleChildrenCheckboxes(this, '#{taskGroup.lsidNoVersion}');"/>
					</t:div>
		        		            
		        </div>
		      </td>
		      <td>&#160;</td>   
		      <td colspan="2">
		      	<h:outputText value="#{taskGroup.name}"/>		        
		        <br/>
		        <h:outputText styleClass="smalltype5" value="#{taskGroup.description}"/>       
		      </td>
		    </tr>
		    
		    <t:dataList var="versionInfo" value="#{taskGroup.indexedVersions}">
		    	<tr valign="top" class="smalltype5">
		            <td align="center">
					  	<div align="center" name="div_#{taskGroup.lsidNoVersion}">
					  		<t:div rendered="#{!versionInfo.allowed}">
					  			<input type="checkbox" name="selectedVersions" disabled="true" value="#{versionInfo.lsid}"/>
					  		</t:div>
					  		<t:div rendered="#{versionInfo.allowed}">
					  			<input type="checkbox" name="selectedVersions" value="#{versionInfo.lsid}"/>
					  		</t:div>	
				      	</div>
		            </td>
		            <td align="center"><a href="#{taskGroup.pipeline ? '/gp/viewPipeline.jsp?name=' : '/gp/addTask.jsp?name='}#{versionInfo.lsid}">#{versionInfo.version}</a></td>
		            <td><a href="#{taskGroup.pipeline ? '/gp/viewPipeline.jsp?name=' : '/gp/addTask.jsp?name='}#{versionInfo.lsid}">#{versionInfo.reason}</a></td>
		            <td><t:dataList var="pipelineName" value="#{versionInfo.pipelineNames}">
		                  #{pipelineName}<br/>
		                 </t:dataList>
		            </td>
					
		        </tr>  
			 </t:dataList>
			 
          </t:dataList>
          </div>
          <!--  End task title row  -->

          <!--  Versions -->
          <!--  Loop through versions.  Something like this 
          <t:dataList var="taskInfo" value="#{taskObject.versions}">     
          -->
          
          <!--  Record id of checkbox.  Makes check all /uncheck all easier -->
           
          <!--  End through versions.  -->
          <!--  End loop through tasks  -->
          
          <tr>
            <td class="smalltype" align="center" valign="top">
              <h:commandLink actionListener="#{manageTasksBean.delete}" onclick="if (!confirmDelete()) return false">delete</h:commandLink> 
			</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
          </tr>
        </tbody>
      </table>
      </h:form>
    </ui:define>
  </ui:composition>
</html>
