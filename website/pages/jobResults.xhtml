<?xml version="1.0" encoding="UTF-8"?>
<!--  Loop through job list -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:t="http://myfaces.apache.org/tomahawk" xmlns:c="http://java.sun.com/jstl/core" xmlns:tr="http://myfaces.apache.org/trinidad">
  <ui:composition template="/templates/common.xhtml">
    <ui:define name="pageTitle">
		GenePattern | Job Results
	</ui:define>
    <ui:define name="headText">
      <link href="#{facesContext.externalContext.requestContextPath}/css/style-jobresults.css" rel="stylesheet" type="text/css"/>
      <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/MochiKit/MochiKit.js"/>
      <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/prototype.js"/>
      <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/jobResults.js"/>
      <script type="text/javascript" language="javascript"> 

/* <![CDATA[ */

    var fileRows = new Object();

    function toggleJobCheckboxes(jobNo)
    {
      var mainCheckbox = document.getElementById("cb_job_" + jobNo);
      var isChecked = mainCheckbox.checked;
      var rowIds = fileRows[jobNo];
      for(var i=0; i<rowIds.length; i++)
      {
        var row = document.getElementById(rowIds[i]);
        var elements = row.getElementsByTagName("input");
        for(var j=0; j<elements.length; j++) 
        {
          if(elements[j].type == "checkbox") {
             elements[j].checked = isChecked;
          }
        }
      }
    }
      
    function toggleAllCheckboxes(maincheckbox)
    {
      var isChecked = maincheckbox.checked;
      var elements = document.getElementsByClassName("jobTableCB");
      for(var j=0; j<elements.length; j++) 
      {
        if(elements[j].type == "checkbox") 
        {
          elements[j].checked = isChecked;
        }
      }
    }
 
                               
    function toggleVisibility(jobNo) {
      var hiddenField = document.getElementById("expansion_state_" + jobNo);    
      if(hiddenField.value == "false")
      {
        showCategory(jobNo);
        hiddenField.value = "true";
      }
      else
      {
        hideCategory(jobNo);
        hiddenField.value = "false";
      }
    }

    function hideCategory( jobNo ) {
      var downArrow = document.getElementById(jobNo + "_expanded_img");
      var rightArrow = document.getElementById(jobNo + "_collapsed_img");	
      downArrow.style.display ="none";
      rightArrow.style.display ="inline"	  
    
      var rowIds = fileRows[jobNo];
      for(var i=0; i<rowIds.length; i++)
      {
        row = document.getElementById(rowIds[i]);
        if(row != null) row.style.display="none";
      }
    }

    function showCategory( jobNo ) {
      var downArrow = document.getElementById(jobNo + "_expanded_img");
      var rightArrow = document.getElementById(jobNo + "_collapsed_img");	
      downArrow.style.display ="inline";
      rightArrow.style.display ="none"

      var rowIds = fileRows[jobNo];
      for(var i=0; i<rowIds.length; i++)
      {
        row = document.getElementById(rowIds[i]);
        if(row != null) row.style.display="";
      }
    }


    function openAll() {
      for(property in fileRows) {
        showCategory(property);
      }        
    }
    function closeAll() {
      for(property in fileRows) {
        hideCategory(property);
      }        
    }
	

		
		
	function confirmDelete() {
		var warn = #{jobResultsBean.warnBeforeDeletingJobs};
		if (warn && !confirm('Are you sure you want to delete the selected job(s)?')) return false;
		return true;
	}
	
/* ]]> */

	</script>
    </ui:define>
    <ui:define name="mainNav">
      <input type="checkbox" name="checkbox" value="checkbox"/>email notification&#160;&#160;&#160;&#160;
      <input type="checkbox" name="showAll" value="showAll" onclick="javascript:window.location='zipJobResults.jsp?showAll=1'"/>show everyone's jobs&#160;&#160;&#160;&#160;
      <input type="checkbox" name="showLogs" value="showLogs" onclick="toggleLogs()"/>show execution logs	
	</ui:define>
	
	
    <ui:define name="body">
    <h:form>
    
      <table width="100%" border="0" cellpadding="0" cellspacing="0" class="barhead-other">
        <tr>
          <td>Job Results</td>
        </tr>
      </table>
      <div class="sorting_text">
        <strong>sort jobs by: </strong>
        <select name="sortjobs" id="sortjobs" onchange="MM_jumpMenu('parent',this,0)">
          <option selected="selected">job id number</option>
          <option>name</option>
          <option>date submitted</option>
          <option>date completed</option>
          <option>status</option>
        </select>
	      &#160;<a href="#" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('jobsorder','','#{facesContext.externalContext.requestContextPath}/images/sort-down-over.gif',1)">
          <img src="#{facesContext.externalContext.requestContextPath}/images/sort-down.gif" alt="jobs order" name="jobsorder" width="11" height="16" border="0" align="absmiddle" id="jobsorder"/>
        </a>		  
		 &#160; &#160; &#160; &#160;
		<strong>sort files by:</strong>
        <select name="sortfiles" id="sortfiles" onchange="MM_jumpMenu('parent',this,0)">
          <option>name</option>
          <option>size</option>
          <option selected="selected">date completed</option>
          <option>status</option>
        </select>
		    &#160;<a href="#" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('filesorder','','#{facesContext.externalContext.requestContextPath}/images/sort-down-over.gif',1)">
          <img src="#{facesContext.externalContext.requestContextPath}/images/sort-down.gif" alt="files order" name="filesorder" width="11" height="16" border="0" align="absmiddle" id="filesorder"/>
        </a>
        &#160;&#160;
       <input name="sort" type="submit" id="sort" value="sort"/>
      </div>
      
      <!-- Job results table -->
      <table width="100%" border="0" cellspacing="0" cellpadding="0">
 
        <tr class="smalltype">
          <td>&#160;</td>         
          <td valign="top">
            <nobr>
              <div align="center">
                <a href="#">download</a> | <a href="#">delete</a>
              </div>
            </nobr>
          </td>         
          <td>&#160;</td>         
          <td>
            <a href="#" onclick="openAll();">open all</a> | <a href="#" onclick="closeAll();">close all</a>
          </td>
          <td>&#160;</td>
          <td>&#160;</td>
          <td>&#160;</td>
          <td>&#160;</td>
        </tr>
        
        <tr class="tableheader-row">
          <td>job</td>
          <td>
            <div align="center">
              <input name="checkbox" type="checkbox" value="checkbox" onclick="toggleAllCheckboxes(this);"/>
            </div>
          </td>
          <td>&#160;</td>
          <td>task/file</td>
          <td>size&#160;</td>
          <td>submitted &#160;</td>
          <td>completed &#160;</td>
          <td>
            <div align="center">&#160;status&#160;</div>
          </td>
        </tr>
        
        <!--  Loop through job list -->
        <t:dataList value="#{jobResultsBean.jobResults}" var="jobResult">
        
          <!--  Begin task title row -->
          <tr class="task-titlerow">
            <td>
               <a href="link">#{jobResult.jobInfo.jobNumber}</a>
               <input type="hidden" 
                  id="expansion_state_#{jobResult.jobInfo.jobNumber}"
                  name="expansion_state_#{jobResult.jobInfo.jobNumber}"
                  value="#{jobResult.expanded}"/>  
            </td>
            <td>
              <div align="center">
                <input name="checkbox" type="checkbox" class="jobTableCB" onclick="toggleJobCheckboxes('#{jobResult.jobInfo.jobNumber}');"
                       id="cb_job_#{jobResult.jobInfo.jobNumber}"/>
              </div>
            </td>
            <td style="cursor: pointer;" onclick="toggleVisibility('#{jobResult.jobInfo.jobNumber}');">
              <div align="right">
                <img id="#{jobResult.jobInfo.jobNumber}_expanded_img" src="#{facesContext.externalContext.requestContextPath}/images/arrow-pipelinetask-down.gif" 
                     width="8" height="8" border="0" style="#{jobResult.expanded == true ? 'display:inline;' : 'display:none;'}"/>
                <img id="#{jobResult.jobInfo.jobNumber}_collapsed_img" src="#{facesContext.externalContext.requestContextPath}/images/arrow-pipelinetask-right.gif" 
                     width="8" height="8" border="0" style="#{jobResult.expanded  == true ? 'display:none;' : 'display:inline;'}"/>
              </div>
            </td>
            <td class="task-title" style="cursor: pointer;" onclick="toggleVisibility('#{jobResult.jobInfo.jobNumber}');">
              #{jobResult.jobInfo.taskName}
              <img src="#{facesContext.externalContext.requestContextPath}/images/menuicon-1.gif" alt="menu" name="Image22" width="14" height="14" border="0" align="absmiddle" id="Image22" onclick="MM_showMenu(window.mm_menu_0925155042_0,11,11,null,'Image22')" onmouseover="MM_swapImage('Image22','','#{facesContext.externalContext.requestContextPath}/images/menuicon-over.gif',1)" onmouseout="MM_swapImgRestore();MM_startTimeout()"/>
            </td>
            <td>&#160;</td>
            <td>
              <h:outputText value="#{jobResult.jobInfo.dateSubmitted}">
                <f:convertDateTime pattern="MMM dd hh:mm:ss a"/>
              </h:outputText>
            </td>
            <td>
              <h:outputText value="#{jobResult.jobInfo.dateCompleted}">
                <f:convertDateTime pattern="MMM dd hh:mm:ss a"/>
              </h:outputText>
            </td>
            <td>
              <div align="center" class="status-finished">finished</div>
            </td>
          </tr>
          <!--  End task title row  -->

          <!-- Loop through job output files -->

          <script type="text/javascript" language="javascript">
            <h:outputText> fileRows['#{jobResult.jobInfo.jobNumber}'] = new Array(); </h:outputText>
          </script>

          <t:dataList value="#{jobResult.outputFiles}" var="fileInfo" rowIndexVar="index">
            <script type="text/javascript" language="javascript">
              <h:outputText>
	             fileRows['#{jobResult.jobInfo.jobNumber}'][#{index}] = 'file_row_#{jobResult.jobInfo.jobNumber}_#{index}';
              </h:outputText>
            </script>
            <tr class="files" id="file_row_#{jobResult.jobInfo.jobNumber}_#{index}">
              <td>&#160;</td>
              <td>
                <div align="center">
                  <input name="selectedFiles_#{jobResult.jobInfo.jobNumber}" type="checkbox" class="jobTableCB"/>
                </div>
              </td>
              <td>&#160;</td>
              <td>
                <img src="#{facesContext.externalContext.requestContextPath}/images/divider-pix2.gif" width="4" height="4" hspace="6" vspace="2" border="0"/>
                <a href="link">#{fileInfo.name}</a>
                <img src="#{facesContext.externalContext.requestContextPath}/images/menuicon-2.gif" alt="menu" name="Image2" width="14" height="14" border="0" align="absmiddle" id="Image2" onclick="MM_showMenu(window.mm_menu_0925155524_0,11,11,null,'Image2')" onmouseover="MM_swapImage('Image2','','#{facesContext.externalContext.requestContextPath}/images/menuicon-over.gif',1)" onmouseout="MM_swapImgRestore();MM_startTimeout()"/>
              </td>
              <td align="right">#{fileInfo.formattedSize}&#160;&#160;&#160;&#160;</td>
              <td>&#160;</td>
              <td>
                <h:outputText value="#{fileInfo.lastModified}">
                  <f:convertDateTime pattern="MMM dd hh:mm:ss a"/>
                </h:outputText>
              </td>
              <td>&#160;</td>
            </tr>
          </t:dataList>
        </t:dataList>
        <tr>
          <td class="smalltype">&#160;</td>
          <td valign="top" class="smalltype">
            <nobr>
              <div align="center">
                <a href="#">download</a> | <a href="#">delete</a>
              </div>
            </nobr>
          </td>
          <td>&#160;</td>
          <td>&#160;</td>
          <td>&#160;</td>
          <td>&#160;</td>
          <td>&#160;</td>
          <td>&#160;</td>
        </tr>
      </table>
      <p>&#160;</p>
      </h:form>
    </ui:define>

</ui:composition>
</html>
