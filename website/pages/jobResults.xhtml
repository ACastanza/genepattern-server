<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:ui="http://java.sun.com/jsf/facelets" 
      xmlns:h="http://java.sun.com/jsf/html" 
      xmlns:f="http://java.sun.com/jsf/core" 
      xmlns:t="http://myfaces.apache.org/tomahawk" 
      xmlns:c="http://java.sun.com/jstl/core">
  <ui:composition template="/templates/common.xhtml">
    <ui:define name="pageTitle">
		GenePattern | Job Results
	</ui:define>
    <ui:define name="headText">
      <link href="#{facesContext.externalContext.requestContextPath}/css/style-jobresults.css" rel="stylesheet" type="text/css"/>
      <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/jobResults.js"/>
      <script type="text/javascript" language="javascript"> 

/* <![CDATA[ */

    function getContext() {
      return '#{facesContext.externalContext.requestContextPath}';
    }


    // Toggle the sort order state.  

    function toggleSortOrder(id) {

      var hiddenField = $(id + "_field");
      var image = $(id);
      var currentValue = hiddenField.value;
      if(currentValue == "true") {
        hiddenField.value = "false";       
        image.src = '#{facesContext.externalContext.requestContextPath}/images/sort-down.gif';
      }
      else {
        hiddenField.value = "true";       
        image.src = '#{facesContext.externalContext.requestContextPath}/images/sort-up.gif';
      }
    }
    
    function setSortOrderImage(id) {
      var hiddenField = $(id + "_field");
      var image = $(id);
      var currentValue = hiddenField.value;
      if(currentValue == "true") {
         image.src = '#{facesContext.externalContext.requestContextPath}/images/sort-up.gif';
      }
      else {      
        image.src = '#{facesContext.externalContext.requestContextPath}/images/sort-down.gif';
      }
    }


    var fileRows = new Object();

    function toggleJobCheckboxes(jobNo)
    {
      var mainCheckbox = document.getElementById("cb_job_" + jobNo);
      var isChecked = mainCheckbox.checked;
      var rowIds = fileRows[jobNo];
      for(var i=0; i<rowIds.length; i++)
      {
        var row = document.getElementById(rowIds[i]);
        var elements = row.getElementsByTagName("input");
        for(var j=0; j<elements.length; j++) 
        {
          if(elements[j].type == "checkbox") {
             elements[j].checked = isChecked;
          }
        }
      }
    }
      
    function toggleAllCheckboxes(maincheckbox)
    {
      var isChecked = maincheckbox.checked;
      var elements = document.getElementsByTagName("input");
      for(var j=0; j<elements.length; j++) 
      {
        if(elements[j].type == "checkbox" && elements[j].className == "jobTableCB") 
        {
          elements[j].checked = isChecked;
        }
      }
    }
 
                               
    function toggleVisibility(jobNo) {
      var hiddenField = document.getElementById("expansion_state_" + jobNo);    
      if(hiddenField.value == "false")
      {
        showCategory(jobNo);
        hiddenField.value = "true";
      }
      else
      {
        hideCategory(jobNo);
        hiddenField.value = "false";
      }
    }

    function hideCategory( jobNo ) {
      var downArrow = document.getElementById(jobNo + "_expanded_img");
      var rightArrow = document.getElementById(jobNo + "_collapsed_img");	
      downArrow.style.display ="none";
      rightArrow.style.display ="inline"	  
    
      var rowIds = fileRows[jobNo];
      for(var i=0; i<rowIds.length; i++)
      {
        row = document.getElementById(rowIds[i]);
        if(row != null) row.style.display="none";
      }
    }

    function showCategory( jobNo ) {
      var downArrow = document.getElementById(jobNo + "_expanded_img");
      var rightArrow = document.getElementById(jobNo + "_collapsed_img");	
      downArrow.style.display ="inline";
      rightArrow.style.display ="none"

      var rowIds = fileRows[jobNo];
      for(var i=0; i<rowIds.length; i++)
      {
        row = document.getElementById(rowIds[i]);
        if(row != null) row.style.display="";
      }
    }


    function openAll() {
      for(property in fileRows) {
        showCategory(property);
      }        
    }
    function closeAll() {
      for(property in fileRows) {
        hideCategory(property); 
      }        
    }
	
		
	function confirmDelete() {
		return confirm('Are you sure you want to delete the selected job(s)?');

	}
	
/* ]]> */

	</script>
    </ui:define>
    <ui:define name="mainNav">
      <input type="checkbox" name="showAll" value="showAll" />show everyone's jobs&#160;&#160;&#160;&#160;
      <input type="checkbox" name="showLogs" value="showLogs" />show execution logs	
	</ui:define>
	
	
    <ui:define name="body">
      <h:form>     
      <table width="100%" border="0" cellpadding="0" cellspacing="0" class="barhead-other">
        <tr>
          <td>Job Results</td>
        </tr>
      </table>
      <div class="sorting_text">
   
        <!-- Job sort column -->  
        <strong>sort jobs by: </strong>
        <h:selectOneMenu value="#{jobResultsBean.jobSortColumn}">
          <f:selectItem itemLabel="job id number" itemValue="jobNumber"/>
          <f:selectItem itemLabel="name" itemValue="taskName"/>
          <f:selectItem itemLabel="date submitted" itemValue="dateSubmitted"/>
          <f:selectItem itemLabel="date completed" itemValue="dateCompleted"/>
          <f:selectItem itemLabel="status" itemValue="status"/>       
        </h:selectOneMenu> &#160;
        
        <!-- Job sort direction -->
        <img style="cursor: pointer;"
             src="#{facesContext.externalContext.requestContextPath}#{jobResultsBean.jobSortAscending == true ? '/images/sort-up.gif' : '/images/sort-down.gif'}"
             alt="jobs order" width="11" height="16" border="0" align="absmiddle" 
             id="jobSortOrder" name="jobSortOrder" 
             onclick="toggleSortOrder('jobSortOrder')"
	         onmouseover="this.src='#{facesContext.externalContext.requestContextPath}/images/sort-down-over.gif'" 
	         onmouseout="setSortOrderImage('jobSortOrder')"/> 
	    <t:inputHidden
             id="jobSortOrder_field"
             forceId="true"
             value="#{jobResultsBean.jobSortAscending}"/>
		 
		 <!-- File sort column -->
		 &#160; &#160; &#160; &#160;
		<strong>sort files by:</strong>
        <h:selectOneMenu value="#{jobResultsBean.fileSortColumn}">
          <f:selectItem itemLabel="name" itemValue="name"/>
          <f:selectItem itemLabel="size" itemValue="size"/>
          <f:selectItem itemLabel="date completed" itemValue="lastModified"/>
        </h:selectOneMenu> &#160;
      
        <!-- File sort direction --> 
        <img style="cursor: pointer;"
             src="#{facesContext.externalContext.requestContextPath}#{jobResultsBean.fileSortAscending == true ? '/images/sort-up.gif' : '/images/sort-down.gif'}"
             alt="files order" width="11" height="16" border="0" align="absmiddle" 
             id="fileSortOrder" name="fileSortOrder" 
             onclick="toggleSortOrder('fileSortOrder')"
	         onmouseover="this.src='#{facesContext.externalContext.requestContextPath}/images/sort-down-over.gif'" 
	         onmouseout="setSortOrderImage('fileSortOrder')"/> 
	    <t:inputHidden
             id="fileSortOrder_field"
             forceId="true"
             value="#{jobResultsBean.fileSortAscending}"/> &#160;&#160;
             
             
       <h:commandButton value="Sort" actionListener="#{jobResultsBean.sort}" immediate="true"/>

      </div>
      
      <!-- Job results table -->
      <table width="100%" border="0" cellspacing="0" cellpadding="0">
 
        <tr class="smalltype">
          <td>&#160;</td>         
          <td valign="top">
            <nobr>
              <div align="center">
                <h:commandLink action="#{jobResultsBean.delete}" 
                               onclick="if (!confirmDelete()) return false">delete</h:commandLink> 
              </div>
            </nobr>
          </td>         
          <td>&#160;</td>         
          <td>
            <a style="cursor: pointer;" onclick="openAll();">open all</a> | <a style="cursor: pointer;" onclick="closeAll();">close all</a>
          </td>
          <td>&#160;</td>
          <td>&#160;</td>
          <td>&#160;</td>
          <td>&#160;</td>
        </tr>
        
        <tr class="tableheader-row">
          <td>job</td>
          <td>
            <div align="center">
              <input type="checkbox" onclick="toggleAllCheckboxes(this);"/>
            </div>
          </td>
          <td>&#160;</td>
          <td>task/file</td>
          <td>size&#160;</td>
          <td>submitted &#160;</td>
          <td>completed &#160;</td>
          <td>
            <div align="center">&#160;status&#160;</div>
          </td>
        </tr>
        

        <!--  Loop through job list -->
        <t:dataList value="#{jobResultsBean.jobResults}" var="jobResult" rowIndexVar="jobIndex">
        
          <!--  Begin task title row -->
          <tr class="task-titlerow">
            <td>
               <a href="link">#{jobResult.jobInfo.jobNumber}</a>
               <input type="hidden" 
                  id="expansion_state_#{jobResult.jobInfo.jobNumber}"
                  name="expansion_state_#{jobResult.jobInfo.jobNumber}"
                  value="#{jobResult.expanded}"/>  
            </td>
            <td>
              <div align="center">
                <input name="selectedJobs" type="checkbox" class="jobTableCB" value="#{jobResult.jobInfo.jobNumber}"
                       onclick="toggleJobCheckboxes('#{jobResult.jobInfo.jobNumber}');"
                       id="cb_job_#{jobResult.jobInfo.jobNumber}"/>
              </div>
            </td>
            
            <td align="right" style="cursor: pointer;" onclick="toggleVisibility('#{jobResult.jobInfo.jobNumber}');">
              <img id="#{jobResult.jobInfo.jobNumber}_expanded_img" src="#{facesContext.externalContext.requestContextPath}/images/arrow-pipelinetask-down.gif" 
                   width="8" height="8" border="0" style="#{jobResult.expanded == true ? 'display:inline;' : 'display:none;'}"/>
              <img id="#{jobResult.jobInfo.jobNumber}_collapsed_img" src="#{facesContext.externalContext.requestContextPath}/images/arrow-pipelinetask-right.gif" 
                   width="8" height="8" border="0" style="#{jobResult.expanded  == true ? 'display:none;' : 'display:inline;'}"/>
            </td>           
            <td class="task-title" >
              <span style="cursor: pointer;" onclick="toggleVisibility('#{jobResult.jobInfo.jobNumber}');">#{jobResult.jobInfo.taskName}</span>
              <img src="#{facesContext.externalContext.requestContextPath}/images/menuicon-1.gif" 
                   alt="menu" width="14" height="14" border="0" align="absmiddle" 
                   id="Image2_#{jobIndex}"  name="Image2_#{jobIndex}"                   
                   onmouseover="MM_swapImage('Image2_#{jobIndex}','','#{facesContext.externalContext.requestContextPath}/images/menuicon-over.gif',1)" 
                   onmouseout="MM_swapImgRestore();"/>
            </td>
            
            <td>&#160;</td>
            <td>
              <h:outputText value="#{jobResult.jobInfo.dateSubmitted}">
                <f:convertDateTime pattern="MMM dd hh:mm:ss a"/>
              </h:outputText>
            </td>
            <td>
              <h:outputText value="#{jobResult.jobInfo.dateCompleted}">
                <f:convertDateTime pattern="MMM dd hh:mm:ss a"/>
              </h:outputText>
            </td>
            <td>
              <div align="center" class="status-finished">finished</div>
            </td>
          </tr>
          <!--  End task title row  -->

          <!-- Loop through job output files -->

          <script type="text/javascript" language="javascript">
            fileRows['#{jobResult.jobInfo.jobNumber}'] = new Array(); 
          </script>

          <t:dataList value="#{jobResult.outputFiles}" var="fileInfo" rowIndexVar="paramIndex">
            <script type="text/javascript" language="javascript">
              <h:outputText>
	             fileRows['#{jobResult.jobInfo.jobNumber}'][#{paramIndex}] = 'file_row_#{jobResult.jobInfo.jobNumber}_#{paramIndex}';
              </h:outputText>
            </script>
            <tr class="files" id="file_row_#{jobResult.jobInfo.jobNumber}_#{paramIndex}">
              <td>&#160;</td>
              <td>
                <div align="center">
                  <input name="selectedFiles" value="#{fileInfo.absolutePath}"
                         id="selectedFiles_#{jobResult.jobInfo.jobNumber}" type="checkbox" class="jobTableCB"/>
                </div>
              </td>
              <td>&#160;</td>
              <td>
                <img src="#{facesContext.externalContext.requestContextPath}/images/divider-pix2.gif" width="4" height="4" hspace="6" vspace="2" border="0"/>
                <a href="link">#{fileInfo.name}</a>
                <img src="#{facesContext.externalContext.requestContextPath}/images/menuicon-2.gif" 
                     alt="menu" width="14" height="14" border="0" align="absmiddle" 
                     id="Image2_#{jobIndex}_#{paramIndex}" name="Image2_#{jobIndex}_#{paramIndex}" 
                     onmouseover="MM_swapImage('Image2_#{jobIndex}_#{paramIndex}','','#{facesContext.externalContext.requestContextPath}/images/menuicon-over.gif',1)" 
                     onmouseout="MM_swapImgRestore();"/>
              </td>
              <td align="right">#{fileInfo.formattedSize}&#160;&#160;&#160;&#160;</td>
              <td>&#160;</td>
              <td>
                <h:outputText value="#{fileInfo.lastModified}">
                  <f:convertDateTime pattern="MMM dd hh:mm:ss a"/>
                </h:outputText>
              </td>
              <td>&#160;</td>
            </tr>
          </t:dataList>
        </t:dataList>
        
        <tr>
          <td class="smalltype">&#160;</td>
          <td valign="top" class="smalltype">
            <nobr>
              <div align="center">
                <h:commandLink action="#{jobResultsBean.delete}" onclick="if (!confirmDelete()) return false">delete</h:commandLink> 
              </div>
            </nobr>
          </td>
          <td>&#160;</td>
          <td>&#160;</td>
          <td>&#160;</td>
          <td>&#160;</td>
          <td>&#160;</td>
          <td>&#160;</td>
        </tr>
      </table>
      <p>&#160;</p>
    </h:form>
    </ui:define>
    

</ui:composition>
</html>
