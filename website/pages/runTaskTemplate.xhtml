<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:t="http://myfaces.apache.org/tomahawk"
	xmlns:c="http://java.sun.com/jstl/core">

<script type="text/javascript" language="javascript">
<h:outputText>
	var requiredParams = new Array();
</h:outputText>
<c:forEach items="#{runTaskBean.parameters}" var="p" varStatus="s">
	<c:if test="#{p.optional==false}">
    	requiredParams[#{s.index}] = '#{p.name}';
	</c:if>
 </c:forEach>
     	
/* <![CDATA[ */
function validateForm() {
        var error = true;
        var missingParams = "<br/>";
        for (param in requiredParams) {
            var formElementName = requiredParams[param];                
            var e = $(formElementName);
            var type = e.type;
            if (type == "file" || type == "text" || type == "textarea") {
                var value = e.value;
                if (value == null || value == "") {
                    error = true;
                    var name = e.name;
                    name = name.replace(".", " ");
                    missingParams += "<br/>" + "<b>" + name + "</b>";
                }
            }
        }
        d = $("errorMessageDiv");
        t = $("errorMessage");
        if (error) {
            d.style.display = "inline";
            t.innerHTML =
            "<font color=\"red\" size=\"+1\">The task could not be run. The following required parameters need to have values provided:</font>" +
            missingParams;
        } else {
            d.style.display = "hidden";
        }
        return !error;
    }
 /* ]]> */
 </script>

<div id="errorMessageDiv" style="display:none;">
	<p id="errorMessage"></p>
</div>
<table width="100%" border="0" cellpadding="0" cellspacing="0"
	class="barhead-task">
	<tr>
		<td>#{runTaskBean.name} <span class="barhead-version">version
		#{runTaskBean.version}</span></td>
	</tr>
</table>


<form
	action="#{facesContext.externalContext.requestContextPath}/#{runTaskBean.formAction}"
	method="post" ENCTYPE="multipart/form-data" onsubmit="return validateForm();">
	<input type="hidden"
	name="taskLSID" value="#{runTaskBean.lsid}" /> <input type="hidden"
	name="taskName" value="#{runTaskBean.name}" />



<table border="0" cellpadding="0" cellspacing="3" class="attribute"
	valign="top">
	<tbody>
		<tr>
			<td colspan="3"><img
				src="#{facesContext.externalContext.requestContextPath}/images/spacer.gif"
				width="1" height="4" /></td>
		</tr>

		<c:forEach items="#{runTaskBean.parameters}" var="p">
			<tr>
				<c:choose>
					<c:when test="#{p.optional==false}">
						<td valign="middle" align="right" class="attribute-required"><nobr>#{p.displayName}*</nobr></td>
					</c:when>
					<c:otherwise>
						<td valign="middle" align="right"><nobr>#{p.displayName}</nobr></td>
					</c:otherwise>
				</c:choose>

				<td valign="top">
					<c:choose>
						<c:when test="#{p.inputType=='file'}">						
							<input name="#{p.name}" id="#{p.name}" size="30" type="#{p.inputType}"
							onchange="this.form['shadow#{p.name}'].value=this.value;" 
							onblur="javascript:if (this.value.length
							> 0) { this.form['shadow#{p.name}'].value=this.value;
							}" 
							ondrop="this.form['shadow#{p.name}'].value=this.value;"/> 
							<input name="shadow#{p.name}" type="hidden" readonly="true"
							size="90" tabindex="-1" class="shadow"
							style="{ border-style: none; font-style: italic; font-size:9pt; background-color: transparent }" />
						</c:when>
						<c:when test="#{p.inputType=='select'}">
							<select name="#{p.name}" id="#{p.name}">
								<c:forEach items="#{p.choices}" var="c">
									<option value="#{c.value}" selected="{c.selected}">#{c.label}</option>
								</c:forEach>
							</select>
						</c:when>		
						<c:otherwise>
							<input name="#{p.name}" id="#{p.name}" size="30" type="#{p.inputType}" value="#{p.defaultValue}" />
						</c:otherwise>						
					</c:choose>
				</td>
				<td valign="middle" class="description">#{p.displayDescription}</td>
			</tr>
			<tr>
				<td colspan="3"><img
					src="#{facesContext.externalContext.requestContextPath}/images/peramdivider-1.gif"
					width="100%" height="1" vspace="4" /></td>
			</tr>
		</c:forEach>


		<tr>
			<td>&#160;</td>
			<td>&#160;</td>
			<td>&#160;</td>
		</tr>
		<tr>
			<td>&#160;</td>
			<td><input name="cmd" value="run" type="submit" /> <input
				name="reset" value="reset"
				onclick="window.location.href=window.location.href" type="button" />
			<input value="help"
				onclick="window.open('#{facesContext.externalContext.requestContextPath}/getTaskDoc.jsp?name=#{runTaskBean.lsid}', '_new')"
				type="button" /></td>
			<td>&#160;</td>
		</tr>
	</tbody>
</table>
</form>
<p>&#160;</p>

</html>
