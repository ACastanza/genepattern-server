<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:t="http://myfaces.apache.org/tomahawk"
	xmlns:c="http://java.sun.com/jstl/core">


<ui:composition template="/templates/common.xhtml">
	<ui:define name="headText">
		<script type="text/javascript"
	src="#{facesContext.externalContext.requestContextPath}/js/prototype.js"></script>
<script type="text/javascript" language="javascript">
<h:outputText>
	var requiredIds = new Array();
	var requiredNames = new Array();
</h:outputText>
<t:dataList value="#{runTaskBean.parameters}" var="p" rowIndexVar="i">
	<c:if test="#{p.optional==false}">
	requiredIds['#{i}'] = '#{p.name}';
    requiredNames['#{i}'] = '#{p.displayName}';
	</c:if>
 </t:dataList>
 
/* <![CDATA[ */
function exportPipeline(lsid, title) {
	var width = 250;
	var height = 200;
	var exportWindow = window.open('askInclude.jsp?name=' + 
		    lsid +   
		    '&title=' + title, 
		    'export',
		    'alwaysRaised=yes,height=' + height + ',width=' + width + ',menubar=no,location=no,resizable=yes,scrollbars=yes,directories=no,status=no,toolbar=no');
	exportWindow.focus();
}	
	
function getCode(language) {
	var selector = $('languageSelect');
	if(selector.selectedIndex==0) {
		window.alert('Please select a language');
		return false;
	}
	return true;
}

function validateForm() {
        var error = false;
        var missingParams = "<br/>";
        for(var i = 0; i < requiredIds.length; i++) {
            var elementId = requiredIds[i];   
            var displayName = requiredNames[i];          
            var e = $(elementId);
            var type = e.type;
            
            if (type == "file" || type == "text" || type == "textarea") {
                var value = e.value;
                if (value == null || value == "") {
                   error = true;
                   missingParams += "<br/>" + "<b>" + displayName + "</b>";
                }
            }
        }
       
        var d = $("errorMessageDiv");
        var t = $("errorMessage");
        
        if (error) {
            d.style.display = "inline";
            t.innerHTML =
            "<font color=\"red\" size=\"+1\">The task could not be run. The following required parameters need to have values provided:</font>" +
            missingParams;
        } else {
            d.style.display = "hidden";
        }
        
        return !error;
    }

/* ]]> */

</script>
	</ui:define>
	
	<c:when test="#{!empty runTaskBean.lsid}">
		<ui:define name="pageTitle">GenePattern - #{runTaskBean.name}</ui:define>
	</c:when>

	<ui:define name="leftPanel">
		<td width="242" rowspan="2" valign="top" class="tasks" id="tasks">
		<ui:include src="moduleChooser.xhtml" /></td>
	</ui:define>

	<ui:define name="rightPanel">
		<td width="203" rowspan="2" valign="top" class="recentjobs"
			id="recentjobs"><ui:include src="recentJobs.xhtml" /></td>
	</ui:define>

	<ui:define name="body">
		<div id="errorMessageDiv" style="display:none;">
		<p id="errorMessage"></p>
		</div>

		<c:choose>
			<c:when test="#{!empty runTaskBean.lsid}">
				<table width="100%" border="0" cellpadding="0" cellspacing="0"
					class="barhead-task">
					<tr>
						<td>#{runTaskBean.name}</td>
						<td align="right"><span class="barhead-version">version #{runTaskBean.version} &#160;</span>
						<c:if test="#{!empty runTaskBean.menuItems}">
						<t:jscookMenu layout="hbr" theme="ThemePanel" org.apache.myfaces.STYLE_LOCATION="/css/jscookmenu">
							<t:navigationMenuItem itemLabel="-Change Version-" icon="#{facesContext.externalContext.requestContextPath}/images/menuicon-1.gif">
							<t:navigationMenuItems value="#{runTaskBean.menuItems}" />
							</t:navigationMenuItem>
						</t:jscookMenu>
						</c:if>
						
						</td>
					</tr>
				</table>


				<form
					action="#{facesContext.externalContext.requestContextPath}/#{runTaskBean.formAction}"
					method="post" enctype="multipart/form-data"
					onsubmit="return validateForm();"><input type="hidden"
					name="taskLSID" value="#{runTaskBean.lsid}" /> <input
					type="hidden" name="taskName" value="#{runTaskBean.name}" />



				<table border="0" cellpadding="5" cellspacing="0" class="attribute"
					valign="top">
					<tbody>


						<tr class="taskperameter">
							<td><span class="description"><c:if test="#{runTaskBean.inputParametersExist}">* required field</c:if></span></td>
							<td colspan="2" class="maintasknav2"><input name="cmd"
								value="run" type="submit" /> <input name="reset" value="reset"
								onclick="window.location.href=window.location.href"
								type="button" /> &#160;&#160;<a
								href="#{facesContext.externalContext.requestContextPath}/viewTask.jsp?name=#{runTaskBean.lsid}">properties</a>

							&#160;|&#160;<c:choose>
								<c:when test="#{runTaskBean.pipeline==true}">
									<a
										onclick="exportPipeline('#{runTaskBean.lsid}', '#{runTaskBean.name}');">export</a>
								</c:when>
								<c:otherwise>
									<a
										href="#{facesContext.externalContext.requestContextPath}/makeZip.jsp?name=#{runTaskBean.lsid}">export</a>
								</c:otherwise>
							</c:choose>&#160;|&#160; <c:choose>
								<c:when test="#{runTaskBean.pipeline==false}">
									<a
										href="#{facesContext.externalContext.requestContextPath}/addTask.jsp?name=#{runTaskBean.lsid}">edit</a>
								</c:when>
								<c:otherwise>
									<a
										href="#{facesContext.externalContext.requestContextPath}/pipelineDesigner.jsp?name=#{runTaskBean.lsid}">edit</a>
								</c:otherwise>
							</c:choose> &#160;|&#160;<a target="_blank"
								href="#{facesContext.externalContext.requestContextPath}/getTaskDoc.jsp?name=#{runTaskBean.lsid}">help</a>
							</td>
						</tr>

						<t:dataList value="#{runTaskBean.parameters}" var="p">
							<tr class="taskperameter">
								<c:choose>
									<c:when test="#{p.optional==false}">
										<td valign="top" class="attribute-required"><nobr>#{p.displayName}*</nobr></td>
									</c:when>
									<c:otherwise>
										<td valign="top"><nobr>#{p.displayName}</nobr></td>
									</c:otherwise>
								</c:choose>

								<td valign="top"><c:choose>
									<c:when test="#{p.inputType=='file'}">
										<input name="#{p.name}" id="#{p.name}" size="30"
											type="#{p.inputType}"
											onchange="this.form['shadow#{p.name}'].value=this.value;"
											onblur="javascript:if (this.value.length
							> 0) { this.form['shadow#{p.name}'].value=this.value;
							}"
											ondrop="this.form['shadow#{p.name}'].value=this.value;" />
										<input name="shadow#{p.name}" type="hidden" readonly="true"
											size="90" tabindex="-1" class="shadow"
											style="{ border-style: none; font-style: italic; font-size:9pt; background-color: transparent }" />
									</c:when>
									<c:when test="#{p.inputType=='select'}">
										<select name="#{p.name}" id="#{p.name}">
											<t:dataList value="#{p.choices}" var="c">
												<c:choose>
													<c:when test="#{c.selected}">
														<option value="#{c.value}" selected="true">#{c.label}</option>
													</c:when>
													<c:otherwise>
														<option value="#{c.value}">#{c.label}</option>
													</c:otherwise>
												</c:choose>
											</t:dataList>
										</select>
									</c:when>
									<c:otherwise>
										<input name="#{p.name}" id="#{p.name}" size="30"
											type="#{p.inputType}" value="#{p.defaultValue}" />
									</c:otherwise>
								</c:choose></td>
								<td valign="top" class="description">#{p.displayDescription}</td>
							</tr>

						</t:dataList>

						<c:if test="#{!empty runTaskBean.parameters}">
						<tr>
							<td>&#160;</td>
							<td colspan="2" class="maintasknav2"><input name="cmd"
								value="run" type="submit" /> <input name="reset" value="reset"
								onclick="window.location.href=window.location.href"
								type="button" /> &#160;&#160;<a
								href="#{facesContext.externalContext.requestContextPath}/viewTask.jsp?name=#{runTaskBean.lsid}">properties</a>
							&#160;|&#160;<c:choose>
								<c:when test="#{runTaskBean.pipeline==true}">
									<a
										onclick="exportPipeline('#{runTaskBean.lsid}', '#{runTaskBean.name}');">export</a>
								</c:when>
								<c:otherwise>
									<a
										href="#{facesContext.externalContext.requestContextPath}/makeZip.jsp?name=#{runTaskBean.lsid}">export</a>

								</c:otherwise>
							</c:choose>&#160;|&#160; <c:choose>
								<c:when test="#{runTaskBean.pipeline==false}">
									<a
										href="#{facesContext.externalContext.requestContextPath}/addTask.jsp?name=#{runTaskBean.lsid}">edit</a>
								</c:when>
								<c:otherwise>
									<a
										href="#{facesContext.externalContext.requestContextPath}/pipelineDesigner.jsp?name=#{runTaskBean.lsid}">edit</a>
								</c:otherwise>
							</c:choose> &#160;|&#160;<a target="_blank"
								href="#{facesContext.externalContext.requestContextPath}/getTaskDoc.jsp?name=#{runTaskBean.lsid}">help</a>
							</td>
						</tr>
						</c:if>

					</tbody>
				</table>
				</form>
				<p>&#160;</p>

				<br />
				<div class="download_code"><strong>Download code to
				call #{runTaskBean.name}: </strong>
				<p></p>

				<form method="get"
					action="#{facesContext.externalContext.requestContextPath}/getPipelineCode.jsp" onsubmit="return getCode();">
				<input type="hidden" name="download" value="1" /> <input
					type="hidden" name="name" value="#{runTaskBean.lsid}" /> <select
					name="language" id="languageSelect">
					<option selected="selected">- Language -</option>
					<option>Java</option>
					<option>MATLAB</option>
					<option>R</option>
				</select> &#160; <input type="submit" name="Submit" value="code" /></form>
				</div>


			</c:when>
			<c:otherwise>
			  <c:choose>
			    <c:when test="#{runTaskBean.splashMessage != null}">
			      <p/><h3>#{runTaskBean.splashMessage}</h3>
			    </c:when>
			    <c:otherwise>
			      <ui:include src="splashpage.xhtml" />
			    </c:otherwise>	
			  </c:choose>			
			</c:otherwise>
		</c:choose>
	</ui:define>
</ui:composition>
</html>
